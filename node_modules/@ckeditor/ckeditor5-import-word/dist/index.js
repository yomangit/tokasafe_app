/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x50834f,Command as _0x5389b5}from'@ckeditor/ckeditor5-core/dist/index.js';import{FileDialogButtonView as _0x48dcfe,MenuBarMenuListItemFileDialogButtonView as _0x5505ac,SpinnerView as _0x3bdbe3,Notification as _0x19d338}from'@ckeditor/ckeditor5-ui/dist/index.js';import{ClipboardPipeline as _0x5c9ec2}from'@ckeditor/ckeditor5-clipboard/dist/index.js';import{Range as _0xf818a2}from'@ckeditor/ckeditor5-engine/dist/index.js';import{first as _0x5ce9bc,uid as _0x51b301,logWarning as _0x33821a,logError as _0xa8d7bd}from'@ckeditor/ckeditor5-utils/dist/index.js';function p(_0x1b104c,_0x247c8e){const t=_0x1b104c['t'];switch(_0x247c8e){case'Import\x20from\x20Word':return t('Import\x20from\x20Word');case'An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.':return t('An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.');case'Importing\x20Word\x20document':return t('Importing\x20Word\x20document');default:return _0x247c8e;}}class i extends _0x50834f{static get['pluginName'](){return'ImportWordUI';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}['init'](){const _0x3b6377=this['editor'];_0x3b6377['ui']['componentFactory']['add']('importWord',()=>{const _0x568ddb=this['_createButton'](_0x48dcfe),_0x213f3e=_0x3b6377['commands']['get']('importWord');return _0x568ddb['bind']('isOn')['to'](_0x213f3e,'isBusy'),_0x568ddb['tooltip']=!0x0,_0x568ddb;}),_0x3b6377['ui']['componentFactory']['add']('menuBar:importWord',()=>this['_createButton'](_0x5505ac));}['_createButton'](_0x1df772){const _0x9917ef=this['editor'],_0x20cdfe=_0x9917ef['commands']['get']('importWord'),_0x314a30=new _0x1df772(_0x9917ef['locale']),_0x8c4d0=new _0x3bdbe3();return _0x314a30['set']({'acceptedType':'application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.wordprocessingml.template'}),_0x314a30['set']({'icon':'<svg\x20viewBox=\x220\x200\x2020\x2020\x22\x20xmlns=\x22http://www.w3.org/2000/svg\x22><path\x20d=\x22m14\x200\x205\x204.5v8.892l-1.5-1.8V6.5h-5v-5h-8v3H3V0h11Zm0\x202v3h3.3L14\x202Z\x22/><path\x20d=\x22M10.74\x2018a2.76\x202.76\x200\x200\x201-.469-.5H3V19h9.25v-.374A2.737\x202.737\x200\x200\x201\x2010.74\x2018Z\x22/><path\x20d=\x22M8.5\x206a1.5\x201.5\x200\x200\x201\x201.493\x201.356L10\x207.5v7a1.5\x201.5\x200\x200\x201-1.356\x201.493L8.5\x2016h-7a1.5\x201.5\x200\x200\x201-1.493-1.356L0\x2014.5v-7a1.5\x201.5\x200\x200\x201\x201.356-1.493L1.5\x206h7ZM7.483\x208.795l-.042.088-.986\x202.534-.947-2.528-.043-.092a.601.601\x200\x200\x200-1.042.008l-.042.093-.883\x202.465-.937-2.475-.042-.089a.6.6\x200\x200\x200-1.107.42l.027.093\x201.514\x204\x20.044.092a.6.6\x200\x200\x200\x201.041-.01l.041-.092.88-2.458.925\x202.467.046.096a.602.602\x200\x200\x200\x201.032\x200l.043-.09\x201.554-4\x20.028-.093a.6.6\x200\x200\x200-1.104-.43v.001ZM11.674\x2015.407a.75.75\x200\x201\x200\x201.152.96L14\x2014.96V20h1.5v-5.04l1.174\x201.408a.75.75\x200\x201\x200\x201.152-.96l-2.346-2.816a.95.95\x200\x200\x200-1.46\x200l-2.346\x202.815Z\x22/></svg>\x0a'}),_0x314a30['bind']('isEnabled')['to'](_0x20cdfe),_0x314a30['bind']('label')['to'](_0x20cdfe,'isBusy',_0x5475f4=>p(_0x9917ef['locale'],_0x5475f4?'Importing\x20Word\x20document':'Import\x20from\x20Word')),_0x8c4d0['bind']('isVisible')['to'](_0x20cdfe,'isBusy'),_0x314a30['iconView']['bind']('isVisible')['to'](_0x20cdfe,'isBusy',_0x2c7e46=>!_0x2c7e46),_0x314a30['children']['add'](_0x8c4d0),_0x314a30['on']('done',(_0x115aba,_0x154256)=>{_0x9917ef['execute']('importWord',_0x154256[0x0],{}),_0x9917ef['editing']['view']['focus']();}),_0x314a30;}}class d extends _0x5389b5{['_importMarker'];['_undoStepBatch'];['_abortController'];constructor(_0x5f5a8b){super(_0x5f5a8b),this['set']('isBusy',!0x1),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['on']('dataInsert',(_0x2e3361,_0x4ac039)=>{const _0xe44f85=new DataTransfer();_0xe44f85['setData']('text/html',_0x4ac039['html']);const _0x224350=this['_importMarker']['getRange']();this['editor']['model']['enqueueChange'](this['_undoStepBatch'],_0x97caf1=>{this['_importMarker']['stopListening'](),_0x97caf1['setSelection'](_0x224350),_0x5f5a8b['editing']['view']['document']['fire']('clipboardInput',{'dataTransfer':_0xe44f85});});},{'priority':'low'});}['refresh'](){this['isEnabled']=this['_checkEnabled']();}['execute'](_0x3c7dbd,_0x503298={}){if(this['isBusy'])return Promise['resolve']();const _0x370cf2=this['editor']['config']['get']('importWord');if(this['editor']['plugins']['has']('MergeFields')){const {prefix:_0xf563b4,suffix:_0x475d78}=this['editor']['config']['get']('mergeFields');_0x503298['merge_fields']={'prefix':_0xf563b4,'suffix':_0x475d78};}const _0x4f202f={'url':_0x370cf2['converterUrl'],'file':_0x3c7dbd,'serviceConfig':{..._0x503298,'formatting':_0x370cf2['formatting'],'timezone':new Intl['DateTimeFormat']()['resolvedOptions']()['timeZone']}};return this['_prepareForImport'](),this['_sendImportRequest'](_0x4f202f)['then'](this['_handleImportResponse']['bind'](this))['catch'](this['_handleImportFailure']['bind'](this))['finally'](this['_cleanUpAfterImport']['bind'](this));}['_checkEnabled'](){if(this['isBusy'])return!0x1;const _0x10d37e=this['editor']['model'],_0x209cc8=_0x10d37e['schema'],_0x2e17c8=_0x10d37e['document']['selection'],_0x3a0387=_0x5ce9bc(_0x2e17c8['getSelectedBlocks']());return!!_0x3a0387&&_0x209cc8['checkChild'](_0x3a0387['parent'],'paragraph');}['_prepareForImport'](){const _0x29a047=this['editor'],_0x2b672a=_0x29a047['model'],_0x34179d=_0x2b672a['document']['selection'];this['_abortController']=new AbortController(),this['_undoStepBatch']=_0x29a047['model']['createBatch']({'isUndoable':!0x0}),_0x2b672a['enqueueChange'](this['_undoStepBatch'],_0x172140=>{_0x34179d['isCollapsed']||_0x2b672a['deleteContent'](_0x34179d,{'leaveUnmerged':!0x0});const _0x1aa719=_0x34179d['getFirstPosition'](),_0x1a627a=_0x5ce9bc(_0x34179d['getSelectedBlocks']());let _0x2c76b2;_0x2c76b2=_0x1a627a['is']('element','paragraph')&&_0x1a627a['isEmpty']?_0x1aa719:_0x1aa719['isAtStart']?_0x2b672a['createPositionBefore'](_0x1a627a):_0x1aa719['isAtEnd']?_0x2b672a['createPositionAfter'](_0x1a627a):_0x172140['split'](_0x1aa719)['position'],this['_importMarker']=_0x172140['addMarker']('importWord:'+_0x51b301(),{'usingOperation':!0x1,'affectsData':!0x1,'range':new _0xf818a2(_0x2c76b2)}),this['_importMarker']['on']('change:range',()=>{'$graveyard'===this['_importMarker']['getRange']()['root']['rootName']&&this['_abortController']['abort']();});}),this['isBusy']=!0x0,this['refresh']();}['_cleanUpAfterImport'](){const _0x1c4573=this['editor']['model'];_0x1c4573['markers']['has'](this['_importMarker'])&&_0x1c4573['enqueueChange'](this['_undoStepBatch'],_0x195a69=>{_0x195a69['removeMarker'](this['_importMarker']);}),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['isBusy']=!0x1,this['refresh']();}['_sendImportRequest']({url:_0x2754ff,file:_0x5bacec,serviceConfig:_0x4fdced}){const _0x31d673=this['editor']['plugins']['get']('ImportWordEditing')['getToken'](),_0x3c3a07=new FormData();_0x3c3a07['set']('config',JSON['stringify'](_0x4fdced)),_0x3c3a07['set']('file',_0x5bacec);const _0x12ea9f={'method':'POST','headers':{},'body':_0x3c3a07,'signal':this['_abortController']['signal']};return _0x31d673&&(_0x12ea9f['headers']['Authorization']=_0x31d673['value']),fetch(_0x2754ff,_0x12ea9f);}['_handleImportResponse'](_0x52a89b){return _0x52a89b['ok']?_0x52a89b['json']()['then'](_0x20746b=>{if(!this['editor']['model']['markers']['has'](this['_importMarker']))return;'$graveyard'!==this['_importMarker']['getRange']()['root']['rootName']&&this['fire']('dataInsert',_0x20746b);}):Promise['reject']();}['_handleImportFailure'](){if(this['_abortController']['signal']['aborted'])return void _0x33821a('import-word-plugin-import-cancelled');const _0x3b2e6a=this['editor'],_0x22c8c3=p(_0x3b2e6a['locale'],'An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.');_0x3b2e6a['plugins']['get']('Notification')['showWarning'](_0x22c8c3),_0xa8d7bd('import-word-plugin-conversion-failed');}}class e extends _0x50834f{['_token'];static get['pluginName'](){return'ImportWordEditing';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}static get['requires'](){return[_0x19d338,_0x5c9ec2,'CloudServices'];}constructor(_0x5d7e14){super(_0x5d7e14),this['_token']=null;}async['init'](){const _0x5eb134=this['editor'];_0x5eb134['config']['define']('importWord',{'converterUrl':'https://docx-converter.cke-cs.com/v2/convert/docx-html','tokenUrl':(_0x5eb134['config']['get']('cloudServices')||{})['tokenUrl'],'formatting':{'resets':'none','defaults':'none','styles':'inline'}}),_0x5eb134['commands']['add']('importWord',new d(_0x5eb134));const {tokenUrl:_0x517714}=_0x5eb134['config']['get']('importWord');if(_0x517714){const {tokenUrl:_0x189e81}=_0x5eb134['config']['get']('cloudServices')||{};this['_token']=_0x517714===_0x189e81?_0x5eb134['plugins']['get']('CloudServices')['token']:await _0x5eb134['plugins']['get']('CloudServices')['registerTokenUrl'](_0x517714);}}['getToken'](){return this['_token'];}}class o extends _0x50834f{static get['pluginName'](){return'ImportWord';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}static get['requires'](){return[e,i];}}export{o as ImportWord,e as ImportWordEditing,i as ImportWordUI};