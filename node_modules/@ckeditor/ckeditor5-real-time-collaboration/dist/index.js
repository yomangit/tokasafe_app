/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{ContextPlugin as _0x37d354,Plugin as _0x455b90,PendingActions as _0x2c1ccc,Context as tt}from'@ckeditor/ckeditor5-core/dist/index.js';import{DomEmitterMixin as _0x2dae14,CKEditorError as _0x347968,Collection as _0x69c784,global as _0x3c7ff6,version as ht,uid as _0x1ac068,KeystrokeHandler as _0x58d4c0}from'@ckeditor/ckeditor5-utils/dist/index.js';import{Notification as _0x10c53f,View as _0x49e569,ListView as _0x49cbdf,ListItemView as rt,LabelView as at,BalloonPanelView as _0x242f2b,clickOutsideHandler as _0x547f6d,BodyCollection as _0x508dce}from'@ckeditor/ckeditor5-ui/dist/index.js';import{LiveRange as dt,History as _0xf84246,NoOperation as _0x1a392d,InsertOperation as _0x30f08d,MarkerOperation as _0x101744,RootAttributeOperation as _0x550785,transformSets as _0x441f35,OperationFactory as _0x4efcc5}from'@ckeditor/ckeditor5-engine/dist/index.js';import{WebSocketGateway as ut,WEB_SOCKET_GATEWAY_STATES as _0x3cf5df,CollaborativeEditingService as _0x39c02e,User as ft,CommentsService as et,TrackChangesService as it,RevisionHistoryService as _0x1ac6b3,EditorService as _0x5d7202}from'@ckeditor/ckeditor-cloud-services-collaboration/dist/index.js';import{Users as _0x15eabc,UserView as ct}from'ckeditor5-collaboration/dist/index.js';import{Compressor as _0x1d21e4}from'@ckeditor/ckeditor5-operations-compressor/dist/index.js';import{isElement as _0x3dd12e}from'lodash-es';class c extends _0x37d354{static ['WebSocketGateway']=/* #__PURE__ -- @preserve */
((()=>ut)());static ['initialReconnectionInterval']=0x3e8;['connection'];['_reconnectionStack'];['_shouldPluginsReconnect'];['_domEmitter'];static get['requires'](){return['CloudServices',_0x10c53f];}static get['pluginName'](){return'WebSocketGateway';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}constructor(_0x2c2ed8){super(_0x2c2ed8),this['set']('state',_0x3cf5df['CONNECTED']),this['set']('_isBrowserOffline',!0x1),this['_reconnectionStack']=new Set(),this['_shouldPluginsReconnect']=!0x1,this['_domEmitter']=Object['create'](_0x2dae14);}['init'](){const _0x4bd6bf=this['context'],_0x535286=_0x4bd6bf['plugins']['get']('CloudServices'),_0x1e0e19=_0x4bd6bf['plugins']['get'](_0x10c53f);if(!_0x535286['token'])throw new _0x347968('websocketgateway-missing-token',this);if(!_0x535286['webSocketUrl'])throw new _0x347968('websocketgateway-missing-websocket-url',this);return this['_domEmitter']['listenTo'](window,'offline',()=>this['_isBrowserOffline']=!0x0),this['_domEmitter']['listenTo'](window,'online',()=>this['_isBrowserOffline']=!0x1),this['context']['config']['define']('cloudServices.connectionTimeout',0xa),this['context']['config']['define']('cloudServices.requestTimeout',0x14),c['WebSocketGateway']['connect'](_0x535286['token'],_0x535286['webSocketUrl'],{'timeout':0x3e8*this['context']['config']['get']('cloudServices.connectionTimeout'),'requestTimeout':0x3e8*this['context']['config']['get']('cloudServices.requestTimeout')})['then'](_0x4dc29a=>{if(this['connection']=_0x4dc29a,this['bind']('state')['to'](_0x4dc29a,'state',this,'_isBrowserOffline',(_0x629bcf,_0x53b727)=>('connected'!==_0x629bcf&&(this['_shouldPluginsReconnect']=!0x0),_0x53b727||_0x629bcf!==_0x3cf5df['CONNECTED']?_0x3cf5df['DISCONNECTED']:this['state']==_0x3cf5df['DISCONNECTED']&&this['_shouldPluginsReconnect']?(this['_shouldPluginsReconnect']=!0x1,this['_reconnect'](),_0x3cf5df['CONNECTING']):_0x3cf5df['CONNECTED'])),this['connection']['on']('error',(_0x226146,_0x8c2abf)=>{if('limitExceeded'!==_0x8c2abf['code'])throw console['error'](_0x8c2abf),new _0x347968('cloudservices-init',null,{'originalError':_0x8c2abf});_0x1e0e19['showWarning']('The\x20limit\x20of\x20maximum\x20concurrent\x20connections\x20that\x20the\x20collaboration\x20server\x20can\x20handle\x20has\x20been\x20reached.\x20Try\x20opening\x20the\x20document\x20again\x20in\x20a\x20few\x20minutes.\x20Please\x20contact\x20your\x20system\x20administrator\x20if\x20the\x20problem\x20persists.',{'title':'Connected\x20users\x20limit\x20exceeded','namespace':'real-time-collaboration'});}),!_0x4dc29a['me'])return new Promise(_0x14bef4=>_0x4dc29a['on']('change:me',_0x14bef4));})['catch'](_0x17f027=>{throw console['error'](_0x17f027),new _0x347968('cloudservices-init',null,{'originalError':_0x17f027});});}['addToReconnectionStack'](_0x2ad9e8){if('function'!=typeof _0x2ad9e8['reconnect'])throw new _0x347968('websocketgateway-invalid-plugin-interface',this);if(this['isInReconnectionStack'](_0x2ad9e8))throw new _0x347968('websocketgateway-plugin-already-registered',this,{'name':_0x2ad9e8['constructor']['pluginName']});this['_reconnectionStack']['add'](_0x2ad9e8);}['removeFromReconnectionStack'](_0x465764){this['_reconnectionStack']['delete'](_0x465764);}['isInReconnectionStack'](_0x3d965f){return this['_reconnectionStack']['has'](_0x3d965f);}['_reconnect'](){return this['connection']['reconnect']()['then'](()=>Promise['all'](Array['from'](this['_reconnectionStack'],_0x3ad547=>_0x3ad547['reconnect']())))['then'](()=>this['state']=_0x3cf5df['CONNECTED'])['catch'](_0x157558=>{throw console['error'](_0x157558),new _0x347968('cloudservices-reconnection-error',this['context']);});}['destroy'](){this['connection']&&this['connection']['disconnect'](),this['state']=_0x3cf5df['DISCONNECTED'],this['_domEmitter']['stopListening'](),super['destroy']();}}class i extends _0x37d354{['channelSessions'];['channelConnectedUsers'];['allConnectedUsers'];['_registeredSessions'];['_uniqueUsersCount'];['_users'];static get['pluginName'](){return'Sessions';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}static get['requires'](){return[c,_0x15eabc];}constructor(_0x516808){super(_0x516808),this['channelSessions']=new Map(),this['channelConnectedUsers']=new Map(),this['allConnectedUsers']=new _0x69c784(),this['_registeredSessions']=new Map(),this['_uniqueUsersCount']=0x0,this['_users']=this['context']['plugins']['get'](_0x15eabc);}['init'](){const _0x4f0e13=this['context']['plugins']['get'](c);this['listenTo'](_0x4f0e13,'change:state',(_0x5e8aba,_0x431d55,_0x13c570)=>{if('connected'!==_0x13c570)this['channelSessions']['forEach'](_0x31f32d=>_0x31f32d['clear']()),this['channelConnectedUsers']['forEach'](_0x55e923=>_0x55e923['clear']()),this['allConnectedUsers']['clear']();else{for(const [_0x105549,_0x1234a9]of this['_registeredSessions'])for(const _0x5b8265 of _0x1234a9)this['_handleSessionAdd'](_0x105549,_0x5b8265);}}),this['_createUser'](_0x4f0e13['connection']['me'],!0x0);}['register'](_0x438175,_0x2d52d8){if(this['_registeredSessions']['has'](_0x438175))throw new _0x347968('sessions-register-already-registered',null,{'channelId':_0x438175});this['_registeredSessions']['set'](_0x438175,_0x2d52d8),this['channelSessions']['set'](_0x438175,new _0x69c784()),this['channelConnectedUsers']['set'](_0x438175,new _0x69c784()),this['listenTo'](_0x2d52d8,'add',(_0x55b78c,_0x1d0338)=>this['_handleSessionAdd'](_0x438175,_0x1d0338)),this['listenTo'](_0x2d52d8,'remove',(_0x34c4bd,_0x4c097b)=>this['_handleSessionRemove'](_0x438175,_0x4c097b));for(const _0x365253 of _0x2d52d8)this['_handleSessionAdd'](_0x438175,_0x365253);}['unregister'](_0x4ad64f){if(!this['_registeredSessions']['has'](_0x4ad64f))throw new _0x347968('sessions-unregister-not-exist',null,{'channelId':_0x4ad64f});const _0x55156f=this['_registeredSessions']['get'](_0x4ad64f);this['stopListening'](_0x55156f);for(const _0x533710 of _0x55156f)'connected'===this['context']['plugins']['get'](c)['state']&&this['_handleSessionRemove'](_0x4ad64f,_0x533710);this['_registeredSessions']['delete'](_0x4ad64f),this['channelSessions']['delete'](_0x4ad64f),this['channelConnectedUsers']['delete'](_0x4ad64f);}get['mySessionId'](){return this['context']['plugins']['get'](c)['connection']['sessionId'];}['getUserBySessionId'](_0xd33835){for(const _0x121e7f of this['channelSessions']['values']())for(const _0x4a7d3d of _0x121e7f)if(_0x4a7d3d['id']===_0xd33835)return _0x4a7d3d['user'];}['getUserSessions'](_0x25d05a,_0x37f828){const _0x15628c=_0x37f828?[this['channelSessions']['get'](_0x37f828)]:this['channelSessions']['values'](),_0x477e0b=new Set();for(const _0x54471a of _0x15628c)for(const _0x1c25f4 of _0x54471a)_0x1c25f4['user']['id']===_0x25d05a['id']&&_0x477e0b['add'](_0x1c25f4['id']);return _0x477e0b;}['getUserRole'](_0x57d734){for(const _0x4841db of this['channelSessions']['values']())for(const _0x2f7f7a of _0x4841db)if(_0x2f7f7a['user']===_0x57d734)return _0x2f7f7a['role'];}['_handleSessionAdd'](_0x4366dd,_0x40aaae){if('connected'!==this['context']['plugins']['get'](c)['state'])return;const _0x16b90b=_0x40aaae['user'],_0x486637=this['_users']['getUser'](_0x16b90b['id'])||this['_createUser'](_0x16b90b),_0x3e9a5a=Object['assign']({},_0x40aaae,{'user':_0x486637});this['channelSessions']['get'](_0x4366dd)['add'](_0x3e9a5a);const _0xab9a=this['channelConnectedUsers']['get'](_0x4366dd);_0xab9a['has'](_0x486637['id'])||_0xab9a['add'](_0x486637),this['allConnectedUsers']['has'](_0x486637['id'])||this['allConnectedUsers']['add'](_0x486637,_0x486637['isMe']?0x0:void 0x0),this['fire']('sessionAdd:'+_0x4366dd,{'channelId':_0x4366dd,'session':_0x3e9a5a});}['_handleSessionRemove'](_0x5bb00d,_0x484473){if('connected'!==this['context']['plugins']['get'](c)['state'])return;const _0x297843=this['channelConnectedUsers']['get'](_0x5bb00d),_0x103ea7=_0x484473['user'];_0x103ea7['id']&&(this['channelSessions']['get'](_0x5bb00d)['remove'](_0x484473['id']),_0x297843['has'](_0x103ea7['id'])&&!this['getUserSessions'](_0x103ea7,_0x5bb00d)['size']&&_0x297843['remove'](_0x103ea7['id']),this['allConnectedUsers']['get'](_0x103ea7['id'])&&!this['getUserSessions'](_0x103ea7)['size']&&this['allConnectedUsers']['remove'](_0x103ea7['id']));}['_createUser'](_0x276170,_0x55963a){const _0xbb8615=this['_users']['addUser'](_0x276170);return _0x55963a&&this['_users']['defineMe'](_0x276170['id']),_0xbb8615['orderNumber']=this['_uniqueUsersCount']++,_0xbb8615;}}class W extends _0x455b90{['_domEmitter']=new(_0x2dae14())();static get['requires'](){return[i];}static get['pluginName'](){return'UserMarkers';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}['init'](){const _0x1b882d=this['editor'],_0x1bae4b=_0x1b882d['plugins']['get'](i);_0x1b882d['conversion']['for']('editingDowncast')['markerToElement']({'model':'user:position','view':(_0x34006b,{writer:_0x5956bb})=>function(_0x429ba6,_0x4d71b0,_0x12f5d5,_0x59592c){const _0x4f0420=_0x429ba6['markerName']['split'](':')[0x2],_0x222c4e=_0x12f5d5['getUserBySessionId'](_0x4f0420);if(!_0x222c4e||_0x4f0420===_0x12f5d5['mySessionId'])return;if(!_0x59592c['model']['schema']['checkChild'](_0x429ba6['markerRange']['start'],'$text'))return;const _0x288232={'class':'ck-user__marker\x20'+_0x222c4e['color']['getMarkerClass'](),'data-name':_0x222c4e['name'],'data-session-id':_0x4f0420},_0x41f5ae=_0x59592c['model']['markers']['get'](_0x429ba6['markerName']),_0x2bb7d2=_0x41f5ae['getStart'](),_0xeb6e7b=_0x2bb7d2['nodeAfter'],_0x3fea5a=_0x59592c['model']['schema'];if(_0xeb6e7b&&_0x3fea5a['isObject'](_0xeb6e7b)&&_0x3fea5a['isInline'](_0xeb6e7b)&&!_0x59592c['model']['markers']['get']('user:range:'+_0x4f0420)['getRange']()['isCollapsed'])return;const _0x17cb0c=_0x2bb7d2['parent'];return _0x59592c['model']['schema']['isLimit'](_0x17cb0c)&&!_0x59592c['model']['hasContent'](_0x17cb0c)&&(_0x288232['contenteditable']=!0x1),function(_0x54bdb3,_0x3fc1a0,_0x264111){const _0x2501e5=_0x54bdb3['createUIElement']('span',_0x3fc1a0);return _0x54bdb3['setCustomProperty']('userPositionMarker',!0x0,_0x2501e5),_0x2501e5['render']=function(_0x20c09d){const _0x411645=this['toDomElement'](_0x20c09d);return _0x411645['innerHTML']='⁠<span\x20class=\x22ck-user__marker-line\x22\x20contenteditable=\x22false\x22><span\x20class=\x22ck-user__marker-dot\x22></span></span><span\x20class=\x22ck-user__marker-tooltip\x22\x20contenteditable=\x22false\x22\x20spellcheck=\x22false\x22>'+_0x264111['name']+'</span>⁠',_0x411645['addEventListener']('mouseenter',()=>{_0x411645['classList']['add']('ck-user__marker_hovered');}),_0x411645['addEventListener']('mouseleave',()=>{_0x411645['classList']['remove']('ck-user__marker_hovered');}),_0x411645;},_0x2501e5['isSimilar']=function(_0x52ee4b){return!(!this['getCustomProperty']('userPositionMarker')||!_0x52ee4b['getCustomProperty']('userPositionMarker')||this['getAttribute']('data-session-id')!=_0x52ee4b['getAttribute']('data-session-id'));},_0x2501e5;}(_0x4d71b0,_0x288232,_0x222c4e);}(_0x34006b,_0x5956bb,_0x1bae4b,_0x1b882d)}),_0x1b882d['conversion']['for']('editingDowncast')['markerToHighlight']({'model':'user:range','view':_0x54fea3=>function(_0x49685f,_0x5570a1){const _0x7bb87f=_0x49685f['markerName']['split'](':')[0x2];if(_0x7bb87f===_0x5570a1['mySessionId'])return null;const _0x407ef4=_0x5570a1['getUserBySessionId'](_0x7bb87f);if(!_0x407ef4)return{'id':_0x7bb87f,'classes':[]};return{'id':_0x7bb87f,'classes':['ck-user__selection',_0x407ef4['color']['getSelectionClass']()],'attributes':{'data-session-id':_0x7bb87f},'priority':0x7d0+_0x407ef4['orderNumber']};}(_0x54fea3,_0x1bae4b)}),function(_0x5976e7){const _0x3f4585=_0x5976e7['model'],_0x5b1cd4=new Map(),_0x5e36a0=_0x5976e7['plugins']['get'](i);_0x3f4585['markers']['on']('update:user:range',(_0x42f3d1,_0x5be62b,_0x2cb611,_0x56241b)=>{if(!_0x56241b&&_0x5b1cd4['get'](_0x5be62b['name']))return _0x5b1cd4['get'](_0x5be62b['name'])['detach'](),void _0x5b1cd4['delete'](_0x5be62b['name']);const _0x57c325=_0x5be62b['name']['split'](':')[0x2];if(_0x57c325===_0x5e36a0['mySessionId'])return;const _0x1be84c='user:position:'+_0x57c325;_0x3f4585['markers']['has'](_0x1be84c)&&_0x5976e7['editing']['reconvertMarker'](_0x1be84c),_0x5be62b['on']('change:range',(_0x4a8aa7,_0x16e796,_0x2b1e22)=>{if('$graveyard'!=_0x16e796['root']['rootName']&&'$graveyard'==_0x5be62b['getRange']()['root']['rootName']&&!_0x5b1cd4['has'](_0x5be62b['name'])){const _0x532c81=_0x3f4585['schema']['getNearestSelectionRange'](_0x2b1e22['deletionPosition']);if(_0x532c81){const _0x3d73d5=dt['fromRange'](_0x532c81);_0x5b1cd4['set'](_0x5be62b['name'],_0x3d73d5),_0x3d73d5['on']('change:range',(_0x47b4c9,_0x112921,_0xccbb9b)=>{if('$graveyard'==_0x3d73d5['root']['rootName']){const _0x170360=_0x3f4585['schema']['getNearestSelectionRange'](_0xccbb9b['deletionPosition']);_0x170360?(_0x3d73d5['start']=_0x170360['start'],_0x3d73d5['end']=_0x170360['end']):(_0x5b1cd4['delete'](_0x5be62b['name']),_0x3d73d5['detach']());}});}}});}),_0x3f4585['document']['on']('change',()=>{_0x5b1cd4['size']>0x0&&_0x3f4585['enqueueChange']({'isUndoable':!0x1},_0x3db958=>{for(const [_0x57df04,_0x23c2f8]of _0x5b1cd4)'$graveyard'==_0x3f4585['markers']['get'](_0x57df04)['getRange']()['root']['rootName']&&(ee(_0x57df04['split'](':')[0x2],_0x23c2f8['toRange'](),_0x3f4585,_0x3db958),_0x23c2f8['detach']());_0x5b1cd4['clear']();});});}(_0x1b882d),this['_domEmitter']['listenTo'](_0x3c7ff6['document'],'keydown',(_0x3f4e96,{key:_0x23c012})=>{'Escape'===_0x23c012&&function(_0x4fc704){_0x4fc704['editing']['view']['change'](_0x4de3fe=>{for(const _0x1d5601 of _0x4fc704['model']['markers']){if(!_0x1d5601['name']['startsWith']('user:position'))continue;const _0x2124f4=_0x4fc704['editing']['mapper']['markerNameToElements'](_0x1d5601['name']);if(_0x2124f4){for(const _0x4b60c7 of _0x2124f4)_0x4de3fe['removeClass']('ck-user__marker_hovered',_0x4b60c7);}}});}(_0x1b882d);},{'useCapture':!0x0});}['afterInit'](){const _0x5caca1=this['editor'],_0x172198=_0x5caca1['commands']['get']('undo');_0x172198&&_0x5caca1['model']['on']('applyOperation',(_0x2a11e6,_0x285b73)=>{const _0x48c3d7=_0x285b73[0x0];if('marker'!=_0x48c3d7['type']||!_0x48c3d7['name']['startsWith']('user:'))return;const _0x5216fd=_0x48c3d7['batch'];_0x172198['_createdBatches']['has'](_0x5216fd)&&(_0x48c3d7['newRange']=_0x48c3d7['oldRange']?_0x5caca1['model']['createRange'](_0x48c3d7['oldRange']['start'],_0x48c3d7['oldRange']['end']):null);},{'priority':'highest'});}['destroy'](){return this['_domEmitter']['stopListening'](),super['destroy']();}['createUserMarkerOperations'](){const _0x3e68ec=this['editor'],_0x489f7f=_0x3e68ec['model']['document'],_0x563d57=_0x3e68ec['plugins']['get'](i);_0x3e68ec['model']['enqueueChange']({'isUndoable':!0x1},_0x4d630d=>{const _0xb0fb77='user:range:'+_0x563d57['mySessionId'],_0x27694a='user:position:'+_0x563d57['mySessionId'],_0x2b767d=_0x3e68ec['model']['markers']['has'](_0xb0fb77);_0x3e68ec['editing']['view']['hasDomSelection']?ee(_0x563d57['mySessionId'],_0x489f7f['selection']['getFirstRange'](),_0x3e68ec['model'],_0x4d630d):_0x2b767d&&(_0x4d630d['removeMarker'](_0xb0fb77),_0x4d630d['removeMarker'](_0x27694a));});}}function ee(_0x267fa0,_0xe8d392,_0x54883b,_0x3a749c){const _0x193eb4='user:range:'+_0x267fa0,_0x5b30c6='user:position:'+_0x267fa0,_0x54fd72=_0xe8d392['getContainedElement']();let _0x4f3888=_0xe8d392['start'];_0x54fd72&&_0x54fd72['is']('element','tableCell')&&(_0x4f3888=function(_0x22616f,_0xfbf4b){for(const _0x3fd19c of _0x22616f['getPositions']())if(_0xfbf4b['schema']['checkChild'](_0x3fd19c,'$text'))return _0x3fd19c;}(_0xe8d392,_0x54883b),_0xe8d392=_0x3a749c['createRange'](_0x4f3888));const _0x5f0b1c=_0x3a749c['createRange'](_0x4f3888);_0x54883b['markers']['has'](_0x193eb4)?(_0x3a749c['updateMarker'](_0x193eb4,{'range':_0xe8d392}),_0x3a749c['updateMarker'](_0x5b30c6,{'range':_0x5f0b1c})):(_0x3a749c['addMarker'](_0x193eb4,{'range':_0xe8d392,'usingOperation':!0x0}),_0x3a749c['addMarker'](_0x5b30c6,{'range':_0x5f0b1c,'usingOperation':!0x0}));}function F(_0x4f425d,_0x4460ab,_0x3acd8a){const _0x51d73d=_0x4f425d['t'],t=_0x4f425d['t'];switch(_0x4460ab){case'PENDING_ACTION_SENDING_DATA':return t({'string':'Sending\x20data\x20to\x20the\x20server.','id':'PENDING_ACTION_SENDING_DATA'});case'The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'Synchronization\x20issue':return t('Synchronization\x20issue');case'Connected\x20users\x20list\x20dropdown\x20menu':return t('Connected\x20users\x20list\x20dropdown\x20menu');case'Collapsed\x20connected\x20users\x20list\x20(press\x20ENTER\x20to\x20open\x20it)':return t('Collapsed\x20connected\x20users\x20list\x20(press\x20ENTER\x20to\x20open\x20it)');case'Connected\x20users\x20list':return t('Connected\x20users\x20list');case'PENDING_ACTION_REVISION_HISTORY':return _0x51d73d({'string':'Unsaved\x20change\x20in\x20revision\x20history.','id':'PENDING_ACTION_REVISION_HISTORY'});case'CONNECTED_USERS':return t({'string':'1\x20connected\x20user\x20(me)','plural':'%0\x20connected\x20users','id':'CONNECTED_USERS'},_0x3acd8a);default:return'';}}let $=0x1;class l extends _0x455b90{static ['CollaborativeEditingService']=/* #__PURE__ -- @preserve */
((()=>_0x39c02e)());['_offset'];['sessionId'];['serverHistory'];['_channelId'];['_service'];['_document'];['_compressor'];['_bufferedOperations'];['_knownOperations'];['_knownRootNames'];['_pendingAction'];['_hasSelectionChanged'];['_sendBufferedOperationsDelayId'];['_baseBufferDelay'];['_currentBufferDelay'];['_lastSyncedOperationId'];['_disconnectionOperations'];['_operationIdentifier'];static get['requires'](){return[c,i,W,_0x2c1ccc,_0x15eabc,_0x10c53f];}static get['pluginName'](){return'RealTimeCollaborationClient';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}get['cloudDocumentVersion'](){return this['_lastServerVersion']+this['_offset'];}get['_lastServerVersion'](){return this['serverHistory']['version']-this['_offset'];}get['lastSyncVersion'](){const _0x8004fc=this['serverHistory']['getOperations']();for(let _0x3b89d9=_0x8004fc['length']-0x1;_0x3b89d9>=0x0;_0x3b89d9--){const _0x3d3088=_0x8004fc[_0x3b89d9];if(!this['_disconnectionOperations']['has'](_0x3d3088))return _0x3d3088['baseVersion']+0x1-this['_offset'];}return 0x0;}constructor(_0x2ff7d8){if(super(_0x2ff7d8),this['_offset']=0x0,this['sessionId']=null,this['serverHistory']=new _0xf84246(),this['editor']['config']['define']('collaboration',{}),this['_channelId']=this['editor']['config']['get']('collaboration.channelId'),!this['_channelId'])throw new _0x347968('collaboration-missing-channelid',this);const _0x183edb=_0x2ff7d8['config']['get']('cloudServices.bundleVersion')||ht;this['_service']=new l['CollaborativeEditingService'](_0x183edb,this['_channelId']),this['_document']=this['editor']['model']['document'],this['_compressor']=new _0x1d21e4(),this['_bufferedOperations']=[],this['_knownOperations']=new WeakSet(),this['_knownRootNames']=new Set(),this['set']('_isPendingUpdate',!0x1),this['set']('_hasSynchronizationProblem',!0x1),this['_pendingAction']=null,this['_hasSelectionChanged']=!0x1,this['_sendBufferedOperationsDelayId']=null,this['_baseBufferDelay']=0x12c,this['_currentBufferDelay']=this['_baseBufferDelay'],this['_lastSyncedOperationId']=null,this['_disconnectionOperations']=new WeakSet(),this['_operationIdentifier']=new Q(this['_disconnectionOperations']);}['init'](){const _0x592620=this['editor'],_0x3ca43c=_0x592620['plugins']['get'](_0x15eabc),_0x28c13d=_0x592620['plugins']['get'](c);this['listenTo'](_0x3ca43c,'getOperationAuthor',(_0x4c20ab,_0x4ccc33)=>{const _0x419628=_0x4ccc33[0x0];_0x419628['_authorId']&&(_0x4c20ab['return']=_0x3ca43c['getUser'](_0x419628['_authorId']),_0x4c20ab['stop']()),null===_0x419628['_authorId']&&(_0x4c20ab['return']=null,_0x4c20ab['stop']());},{'priority':'high'}),this['listenTo'](_0x592620['model']['document']['selection'],'change:range',(_0x5a1017,_0x37b7a2)=>{_0x37b7a2['directChange']&&this['_refreshUserSelectionMarkers']();}),this['listenTo'](_0x592620['editing']['view'],'change:hasDomSelection',()=>{this['_refreshUserSelectionMarkers']();}),this['_initThrowingOnDataSet'](),_0x592620['model']['on']('applyOperation',(_0xa9ad5c,_0x18431c)=>{const _0x5d8677=_0x18431c[0x0];_0x5d8677['isDocumentOperation']&&(this['_saveOperationInBuffer'](_0x5d8677),this['_shouldSendUpdate']()&&this['_sendBufferedOperationsDelayed']());}),this['_setUpDataInit'](),this['bind']('_isEditingAllowed')['to'](_0x28c13d,'state',this,'_hasSynchronizationProblem',(_0x58bee3,_0xcf2aca)=>'connected'===_0x58bee3&&!_0xcf2aca),this['on']('change:_isEditingAllowed',()=>{this['_isEditingAllowed']?_0x592620['disableReadOnlyMode']('rtc-offline'):_0x592620['enableReadOnlyMode']('rtc-offline');}),this['_isEditingAllowed']?_0x592620['disableReadOnlyMode']('rtc-offline'):_0x592620['enableReadOnlyMode']('rtc-offline'),this['set']('_isConnected',!0x1);}async['reconnect'](){const _0x340f42=this['editor']['plugins']['get'](i),_0x31476b=this['editor']['plugins']['get'](c);try{this['_isPendingUpdate']=!0x0,_0x340f42['unregister'](this['_channelId']);const _0x5bf2c9=await this['_service']['reconnect'](_0x31476b['connection'],this['lastSyncVersion']);await this['_handleReconnectionResponse'](_0x5bf2c9)&&(this['_isPendingUpdate']=!0x1,this['_clearPendingAction']());const _0x320214=await this['_service']['getConnectedSessions']();_0x340f42['register'](this['_channelId'],_0x320214),this['_handleSendingSelectionMarkers'](),this['_isConnected']=!0x0;}catch(_0x33e066){if(function(_0x1433f2){return'404'===_0x1433f2['code'];}(_0x33e066)&&this['sessionId'])await this['_connectAfterSessionHasBeenFlushed']();else{if(function(_0x348a83){return'409'===_0x348a83['code'];}(_0x33e066)){const _0x52a429=F(this['editor']['locale'],'The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');this['_handleReconnectionError'](_0x52a429);}else{if(!(_0x33e066 instanceof K))throw _0x33e066;this['_handleReconnectionError']();}}}}['destroy'](){const _0x1240d7=this['editor']['plugins']['get'](c),_0x4dee09=this['editor']['plugins']['get'](i);this['editor']['enableReadOnlyMode']('rtc-destroyed'),_0x4dee09['channelSessions']['has'](this['_channelId'])&&_0x4dee09['unregister'](this['_channelId']),_0x1240d7['removeFromReconnectionStack'](this),this['_disconnectService'](),super['destroy']();}async['_handleReconnectionResponse'](_0x3bfe70){if(this['sessionId']!==_0x3bfe70['sessionId']&&this['_lastSyncedOperationId']!==_0x3bfe70['lastOperationId'])throw new K();return this['sessionId']=_0x3bfe70['sessionId'],this['_handleServerResponse']([],{..._0x3bfe70,'wereChangesApplied':!0x1,'data':_0x3bfe70['data']},'reconnect');}async['_connectService'](_0xbaa718,_0xca6320=!0x1){const {connection:_0x2ff374}=this['editor']['plugins']['get'](c);l['CollaborativeEditingService']['getConnectedSessions'](_0x2ff374,this['_channelId'])['then'](_0x60d72c=>this['_initSessionsHandling'](_0x60d72c))['catch'](_0x7061b4=>{this['_crash']('realtimecollaborationclient-init-session-connection-error',_0x7061b4);}),this['listenTo'](this['_service'],'operationsReceived',this['_handleReceivedOperations']['bind'](this)),this['listenTo'](this['_service'],'error',(_0x3fb56f,_0x2f8c27)=>{this['_crash']('realtimecollaborationclient-initservice-internal-error',_0x2f8c27);}),this['listenTo'](this['_service'],'disconnected',()=>{this['_isConnected']=!0x1;});const _0x483866=this['_operationIdentifier']['getIdOfTheLastOperation'](_0xbaa718);this['_isPendingUpdate']=!0x0;const _0x2785f5=await this['_service']['connect'](_0x2ff374,this['_compressOperations'](_0xbaa718),_0x483866);if(this['sessionId']=_0x2785f5['sessionId'],_0xca6320){if(!_0x2785f5['wereChangesApplied'])return void this['_handleReconnectionError']();this['_isPendingUpdate']=!0x1,this['_clearPendingAction'](),this['serverHistory']['reset'](),this['_offset']=_0x2785f5['offset'],this['serverHistory']['version']=this['_offset'],await this['_handleServerResponse'](_0xbaa718,_0x2785f5,'reconnection:\x20flushed\x20session');}else await this['_handleInitialConnectionData'](_0x2785f5,_0xbaa718);this['_handleSendingSelectionMarkers'](),this['_isConnected']=!0x0;}['_handleSendingSelectionMarkers'](){const _0x2c6311=this['editor']['plugins']['get'](i),_0x40171f=this['editor']['plugins']['get'](W),_0x381260=_0x2c6311['channelSessions']['get'](this['_channelId']);_0x381260&&_0x381260['length']>0x1?_0x40171f['createUserMarkerOperations']():this['listenTo'](_0x2c6311,'sessionAdd:'+this['_channelId'],()=>{0x2===_0x2c6311['channelSessions']['get'](this['_channelId'])['length']&&_0x40171f['createUserMarkerOperations']();});}async['_handleReceivedOperations'](_0xebbb11,_0xc52ce1,_0x43c82f,_0x1da53b){if(!this['_isPendingUpdate']&&this['_document']['version']==_0xc52ce1){const _0x205714=this['_decompressOperations'](_0x43c82f,_0x1da53b);await this['_fetchMissingUsers'](_0x205714),this['_handleExternalOperations'](_0x205714,_0xc52ce1,_0x43c82f['lastOperationId'])||this['_crash']('realtimecollaborationclient-initservice-incorrect-server-operation');}}async['_connectAfterSessionHasBeenFlushed'](){this['_disconnectService']();const {locale:_0x2b2cb3}=this['editor'];let _0x38c44c;try{_0x38c44c=await this['_service']['getDocumentDetails']();}catch(_0x2cf9d8){const _0x38d7d6=F(_0x2b2cb3,'The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');return void this['_handleReconnectionError'](_0x38d7d6);}const _0x22a812=_0x38c44c['currentDocumentSession']||_0x38c44c['lastDocumentSession'];if(this['_lastSyncedOperationId']===_0x22a812['lastOperationId'])await this['_connectService'](this['editor']['model']['document']['history']['getOperations'](),!0x0);else{const _0x54990=F(_0x2b2cb3,'The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');this['_handleReconnectionError'](_0x54990);}}['_disconnectService'](){this['_service']['disconnect'](),this['_bufferedOperations']=[],clearTimeout(this['_sendBufferedOperationsDelayId']),this['stopListening'](this['_service']);}['_initSessionsHandling'](_0x2e4b30){const _0x5c4c14=this['editor']['plugins']['get'](i);this['listenTo'](_0x5c4c14,'sessionAdd:'+this['_channelId'],(_0x136896,{session:_0x11d143})=>{if(_0x11d143['id']===_0x5c4c14['mySessionId']){_0x136896['off']();const _0x423e99=this['editor']['plugins']['has']('CommentsOnly')&&this['editor']['plugins']['get']('CommentsOnly');let _0x30c015=_0x11d143['permissions'];_0x423e99&&_0x423e99['isEnabled']&&(_0x30c015=_0x30c015['filter'](_0xa5f8bb=>'document:write'!==_0xa5f8bb)),this['editor']['plugins']['get']('Permissions')['setPermissions'](_0x30c015,this['_channelId']);}}),_0x5c4c14['register'](this['_channelId'],_0x2e4b30);}['_initThrowingOnDataSet'](){const _0x12632e=this['editor']['data']['set'];this['editor']['data']['set']=(..._0x213810)=>{if(!_0x213810[_0x213810['length']-0x1]['suppressErrorInCollaboration'])throw new _0x347968('realtimecollaborationclient-editor-setdata-and-editor-data-set-are-forbidden-in-real-time-collaboration',this);_0x12632e['apply'](this['editor']['data'],_0x213810);};}['_setUpDataInit'](){this['editor']['data']['on']('init',(_0x1c7960,[_0x13137d])=>{if(this['_document']['version'])throw new _0x347968('realtimecollaborationclient-init-document-already-initialized',this);_0x1c7960['stop'](),this['_setPendingAction']();const _0x5c9841=this['editor']['config']['get']('rootsAttributes'),_0x348ad5=this['_getOperationsFromInitData'](_0x13137d,_0x5c9841);0x0==_0x348ad5['length']&&_0x348ad5['push'](new _0x1a392d(0x0)),_0x1c7960['return']=this['_connectService'](_0x348ad5)['then'](()=>{this['editor']['plugins']['get'](c)['addToReconnectionStack'](this),this['editor']['data']['fire']('ready');})['catch'](_0x23659a=>this['_crash']('realtimecollaborationclient-init-connection-failed',_0x23659a))['finally'](()=>this['_clearPendingAction']());},{'priority':'high'}),this['editor']['on']('loadRoot',async(_0x4738a7,[_0x3a8ac4,_0x326b07])=>{_0x4738a7['stop']();const _0x128659=this['editor']['model']['document']['getRoot'](_0x3a8ac4);if(!this['_knownRootNames']['has'](_0x3a8ac4)){const _0x592c47=_0x326b07&&_0x326b07['data']?_0x326b07['data']:'',_0x155f0e=_0x326b07&&_0x326b07['attributes']?_0x326b07['attributes']:{};await this['_loadRoot'](_0x3a8ac4,_0x592c47,_0x155f0e);}this['editor']['model']['enqueueChange']({'isUndoable':!0x1},()=>{_0x128659['_isLoaded']=!0x0,this['editor']['model']['document']['differ']['_bufferRootLoad'](_0x128659);});},{'priority':'high'});}async['_fetchMissingUsers'](_0x5cabe5){const _0x7cb8ba=this['editor']['plugins']['get'](_0x15eabc),{connection:_0x2a0de9}=this['editor']['plugins']['get'](c),_0x10d304=new Set();for(const _0x318a15 of _0x5cabe5){const _0x31d681=_0x318a15['_authorId'];_0x31d681&&!_0x7cb8ba['getUser'](_0x31d681)&&_0x10d304['add'](_0x31d681);}if(0x0===_0x10d304['size'])return;const _0x39368e=await ft['getMany'](_0x2a0de9,Array['from'](_0x10d304));for(const _0x5b823d of _0x39368e)_0x7cb8ba['getUser'](_0x5b823d['id'])||_0x7cb8ba['addUser'](_0x5b823d);}['_getOperationsFromInitData'](_0x443071,_0x20484c={}){const _0x57ddf7=this['editor']['model'],_0x15f20c=[];let _0x420452=0x0;const _0x4a68c2='string'==typeof _0x443071?{'main':_0x443071}:_0x443071;for(const _0x3e8944 of Object['keys'](_0x4a68c2)){if(!this['_document']['roots']['has'](_0x3e8944))throw new _0x347968('realtimecollaborationclient-init-non-existent-root',this);const _0x3d9beb=this['editor']['data']['parse'](_0x4a68c2[_0x3e8944]),_0x494a35=this['_document']['getRoot'](_0x3e8944),_0x2d4240=new _0x30f08d(_0x57ddf7['createPositionAt'](_0x494a35,0x0),_0x3d9beb,_0x420452++);_0x15f20c['push'](_0x2d4240);for(const [_0x26d098,_0x3b1596]of _0x3d9beb['markers']){const _0x279ed1=_0x57ddf7['createRange'](_0x57ddf7['createPositionFromPath'](_0x494a35,_0x3b1596['start']['path']['slice']()),_0x57ddf7['createPositionFromPath'](_0x494a35,_0x3b1596['end']['path']['slice']())),_0x2219c4=new _0x101744(_0x26d098,null,_0x279ed1,_0x57ddf7['markers'],!0x0,_0x420452++);_0x15f20c['push'](_0x2219c4);}}if(_0x20484c)for(const [_0x26afab,_0x19cb95]of Object['entries'](_0x20484c)){const _0x4c5f74=_0x57ddf7['document']['getRoot'](_0x26afab);if(!_0x4c5f74)throw new _0x347968('multi-root-editor-root-attributes-no-root',null);for(const [_0xd6710b,_0x57848d]of Object['entries'](_0x19cb95))if(null!==_0x57848d){const _0x12df23=new _0x550785(_0x4c5f74,_0xd6710b,null,_0x57848d,_0x420452++);_0x15f20c['push'](_0x12df23);}}return _0x15f20c;}async['_loadRoot'](_0x305deb,_0x2302c6,_0xf18188){this['_getOperationsFromInitData']({[_0x305deb]:_0x2302c6},{[_0x305deb]:_0xf18188})['forEach']((_0x129977,_0x1511f5)=>{_0x129977['baseVersion']=this['_document']['version']+_0x1511f5,_0x129977['_isInit']=!0x0,this['_saveOperationInBuffer'](_0x129977);}),this['_sendBufferedOperationsDelayed'](),await this['_waitUntilSynced']();}async['_handleInitialConnectionData'](_0x4d5962,_0x472abf){let _0x3dd81b;this['_offset']=_0x4d5962['offset'];const _0x259699=_0x4d5962['wereChangesApplied']&&!_0x4d5962['initData'],_0x3aeac7=_0x259699?0x0:_0x4d5962['data']['baseVersion'];if(_0x472abf['forEach'](_0x267af5=>{_0x267af5['_isInit']=!0x0,_0x267af5['createdAt']=_0x4d5962['sessionCreatedAt'],_0x267af5['_authorId']=null;}),_0x259699)_0x3dd81b=_0x472abf,this['_applyOperationsSet'](_0x3dd81b,_0x259699);else{if(_0x4d5962['initData']){const _0x18078e=this['_getOperationsFromInitData'](_0x4d5962['initData']);this['_document']['history']['version']=-_0x18078e['length'],_0x18078e['forEach'](_0x21cb25=>{_0x21cb25['baseVersion']-=_0x18078e['length'],_0x21cb25['createdAt']=_0x4d5962['sessionCreatedAt'],_0x21cb25['_isInit']=!0x0,_0x21cb25['_authorId']=null;}),this['_applyOperationsSet'](_0x18078e,!0x0),this['serverHistory']['version']=-_0x18078e['length']+this['_offset'],this['_updateServerHistory'](_0x18078e);}this['_document']['history']['version']=_0x3aeac7,_0x3dd81b=this['_decompressOperations'](_0x4d5962['data'],_0x4d5962['metadata']),await this['_fetchMissingUsers'](_0x3dd81b),this['_applyOperationsSet'](_0x3dd81b,_0x259699);}_0x4d5962['lastOperationId']&&(this['_operationIdentifier']['setIdForTheLastOperation'](_0x3dd81b,_0x4d5962['lastOperationId']),this['_lastSyncedOperationId']=_0x4d5962['lastOperationId']),this['serverHistory']['version']=_0x3aeac7+this['_offset'],this['_updateServerHistory'](_0x3dd81b),_0x472abf['filter'](_0x239dba=>{const _0x560bee=this['_getAffectedRoot'](_0x239dba);return _0x560bee&&!this['_knownRootNames']['has'](_0x560bee);})['forEach']((_0x2647f1,_0x5aa39b)=>{_0x2647f1['baseVersion']=this['_document']['version']+_0x5aa39b,this['_saveOperationInBuffer'](_0x2647f1);}),this['_shouldSendUpdate']()?(this['_currentBufferDelay']=0x0,this['_sendBufferedOperationsDelayed'](!0x0),await this['_waitUntilSynced']()):(this['_isPendingUpdate']=!0x1,this['_clearPendingAction']());}['_crash'](_0x317ac3,_0x4a204e,_0x414e41){throw this['_isPendingUpdate']=!0x0,_0x4a204e&&console['error'](_0x4a204e),_0x414e41&&this['editor']['enableReadOnlyMode']('realtimecollaborationclient-error'),new _0x347968(_0x317ac3,this['editor']);}['_saveOperationInBuffer'](_0xca35a4){this['_knownOperations']['has'](_0xca35a4)||(this['_knownOperations']['add'](_0xca35a4),this['_bufferedOperations']['push'](_0xca35a4),this['_pendingAction']||'marker'==_0xca35a4['type']&&!_0xca35a4['affectsData']||this['_setPendingAction']());}['_sendBufferedOperationsDelayed'](_0x332465=!0x1){!_0x332465&&this['_isPendingUpdate']||(this['_isPendingUpdate']=!0x0,clearTimeout(this['_sendBufferedOperationsDelayId']),this['_sendBufferedOperationsDelayId']=setTimeout(()=>{this['_sendBufferedOperations']()['then'](_0x387bc7=>{_0x387bc7&&(this['_clearPendingAction'](),this['_isPendingUpdate']=!0x1);})['catch'](_0x29db8a=>{this['_clearPendingAction'](),this['_isPendingUpdate']=!0x1,function(_0x1c3174){return _0x1c3174['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x1c3174['message']['startsWith']('cloud-services-internal-error:\x20Collaborative\x20Editing\x20Service\x20is\x20not\x20connected.')||_0x1c3174['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}(_0x29db8a)||this['_crash'](_0x29db8a['message'],_0x29db8a,!0x0);});},this['_currentBufferDelay']));}['_waitUntilSynced'](){return new Promise(_0x57c9af=>{this['on']('change:_isPendingUpdate',()=>{_0x57c9af();});});}async['_sendBufferedOperations'](){const _0x3fc843=this['editor']['plugins']['get'](W);if(this['_shouldSendSelectionUpdate']()&&(_0x3fc843['createUserMarkerOperations'](),this['_hasSelectionChanged']=!0x1),!this['_shouldSendUpdate']())return!0x0;const _0x321e80=[...this['_bufferedOperations']];for(const _0x143bdc of _0x321e80)_0x143bdc['wasUndone']=this['_document']['history']['isUndoneOperation'](_0x143bdc);const _0x5778b5=this['_operationIdentifier']['getIdOfTheLastOperation'](_0x321e80),_0x2e5fdb=$++,_0x2f5ecf=this['_compressOperations'](_0x321e80),_0x4bef20=await this['_service']['sendOperations'](_0x2f5ecf,_0x2f5ecf['baseVersion'],_0x5778b5);try{return await this['_handleServerResponse'](_0x321e80,_0x4bef20,_0x2e5fdb);}catch(_0x5ebc88){return this['_crash']('realtimecollaborationclient-sendbufferedoperations',_0x5ebc88);}}async['_handleServerResponse'](_0x344b13,_0x1aa470,_0x24d784){if('error'in _0x1aa470)throw _0x1aa470['error'];let _0x406ac1=!0x1;if(_0x1aa470['wereChangesApplied']){_0x1aa470['lastOperationId']&&(this['_lastSyncedOperationId']=_0x1aa470['lastOperationId']),this['_bufferedOperations']=this['_bufferedOperations']['filter'](_0xe62f05=>!_0x344b13['includes'](_0xe62f05));for(const _0x4b81a1 of _0x344b13)_0x4b81a1['createdAt']='lastOperationAcceptedAt'in _0x1aa470&&_0x1aa470['lastOperationAcceptedAt']||void 0x0;J(_0x344b13,_0x1aa470['version']-_0x344b13['length']),this['_updateServerHistory'](_0x344b13);const _0x1026b1=_0x344b13['filter'](_0x113bd3=>{if(!_0x113bd3['_isInit'])return!0x1;const _0x222732=this['_getAffectedRoot'](_0x113bd3);return _0x222732&&!this['_knownRootNames']['has'](_0x222732);});J(_0x1026b1,this['_document']['version']),this['_applyOperationsSet'](_0x1026b1),_0x406ac1=!0x0,this['_currentBufferDelay']=this['_baseBufferDelay'];}else{const _0x2b7d61=this['_decompressOperations'](_0x1aa470['data'],_0x1aa470['metadata'])['filter'](_0x222c93=>_0x222c93['baseVersion']>=this['_lastServerVersion']);_0x2b7d61['forEach'](_0x3b73b9=>this['_addKnownRoot'](_0x3b73b9)),this['_bufferedOperations']=this['_bufferedOperations']['filter'](_0x2aee6e=>!_0x2aee6e['_isInit']||!this['_knownRootNames']['has'](this['_getAffectedRoot'](_0x2aee6e))),this['_bufferedOperations']['length']&&J(this['_bufferedOperations'],this['_bufferedOperations'][0x0]['baseVersion']),await this['_fetchMissingUsers'](_0x2b7d61),_0x406ac1=this['_handleExternalOperations'](_0x2b7d61,_0x1aa470['version'],_0x1aa470['lastOperationId']),this['_currentBufferDelay']=Math['round'](this['_currentBufferDelay']/0x2);}return _0x406ac1?!this['_shouldSendUpdate']()||(this['_sendBufferedOperationsDelayed'](!0x0),!0x1):this['_crash']('realtimecollaborationclient-handleserverresponse');}['_handleExternalOperations'](_0x16c517,_0xc08dac,_0x26fe4a){try{const _0x48b0a8={'document':this['_document'],'useRelations':!0x1,'padWithNoOps':!0x0},{operationsA:_0x287898,operationsB:_0x2bb30c,originalOperations:_0x428e0b}=_0x441f35(_0x16c517,this['_bufferedOperations'],_0x48b0a8);J(_0x287898,this['_document']['version']),J(_0x2bb30c,_0xc08dac);for(const _0x49f02a of _0x287898){const _0x42929f=_0x428e0b['get'](_0x49f02a);_0x49f02a['_authorId']=_0x42929f?_0x42929f['_authorId']:null;}_0x26fe4a&&(this['_operationIdentifier']['setIdForTheLastOperation'](_0x16c517,_0x26fe4a),this['_lastSyncedOperationId']=_0x26fe4a),this['_bufferedOperations']=[..._0x2bb30c],this['_applyOperationsSet'](_0x287898),this['_updateServerHistory'](_0x16c517);}catch(_0x4bbce3){return console['error'](_0x4bbce3),!0x1;}return!0x0;}['_applyOperationsSet'](_0x3d228e,_0x4614c=!0x1){this['editor']['model']['enqueueChange']({'isUndoable':!0x1,'isLocal':!0x1},_0x4f9198=>{for(const _0x13e4ca of _0x3d228e)this['_knownOperations']['add'](_0x13e4ca),this['_addKnownRoot'](_0x13e4ca),_0x4f9198['batch']['addOperation'](_0x13e4ca),this['editor']['model']['applyOperation'](_0x13e4ca);});}['_addKnownRoot'](_0x2df87d){const _0x3c2e55=this['_getAffectedRoot'](_0x2df87d);_0x3c2e55&&this['_knownRootNames']['add'](_0x3c2e55);}['_getAffectedRoot'](_0x415ef9){let _0x48d0ea,_0x42d4c3;switch(_0x415ef9['type']){case'insert':_0x48d0ea=_0x415ef9['position']['root'];break;case'marker':if(_0x42d4c3=_0x415ef9['newRange'],!_0x42d4c3)return null;_0x48d0ea=_0x42d4c3['root'];break;case'addRootAttribute':_0x48d0ea=_0x415ef9['root'];break;case'addRoot':_0x48d0ea=_0x415ef9['affectedSelectable'];break;case'move':_0x48d0ea=_0x415ef9['targetPosition']['root'];break;default:return null;}return _0x48d0ea['rootName'];}['_updateServerHistory'](_0xe7a7f8){_0xe7a7f8['forEach'](_0x220fda=>{const _0x542e48=_0x220fda['clone']();_0x542e48['_authorId']=_0x220fda['_authorId'],_0x542e48['_isInit']=!!_0x220fda['_isInit'],_0x542e48['createdAt']=_0x220fda['createdAt'],_0x542e48['baseVersion']+=this['_offset'],_0x220fda['_isDisconnection']&&this['_disconnectionOperations']['add'](_0x542e48),this['serverHistory']['addOperation'](_0x542e48);});}['_handleReconnectionError'](_0x514daa){const _0x3fbc21=this['editor']['plugins']['get']('Notification'),_0x21a5e7=this['editor']['locale'];_0x514daa||(_0x514daa=F(_0x21a5e7,'The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.')),_0x3fbc21['showWarning'](_0x514daa,{'title':F(_0x21a5e7,'Synchronization\x20issue'),'namespace':'real-time-collaboration'}),this['_hasSynchronizationProblem']=!0x0,clearTimeout(this['_sendBufferedOperationsDelayId']),this['_bufferedOperations']=[],this['editor']['plugins']['get'](c)['destroy']();}['_setPendingAction'](){this['_pendingAction']||(this['_pendingAction']=this['editor']['plugins']['get'](_0x2c1ccc)['add'](F(this['editor']['locale'],'PENDING_ACTION_SENDING_DATA')));}['_clearPendingAction'](){this['_pendingAction']&&(this['editor']['plugins']['get'](_0x2c1ccc)['remove'](this['_pendingAction']),this['_pendingAction']=null);}['_compressOperations'](_0x2079cb){const _0x2c98ae=_0x2079cb['map'](_0x41f973=>_0x41f973['toJSON']());return this['_compressor']['compress'](_0x2c98ae);}['_decompressOperations'](_0x387b7f,_0x34666b){return this['_compressor']['decompress'](_0x387b7f)['map']((_0x14d588,_0x400520)=>{const _0xe3fbc2='init'==_0x34666b[_0x400520]['type'];if('InsertOperation'==_0x14d588['__className']){const _0x51a792=_0x14d588['position']['root'];!this['_document']['getRoot'](_0x51a792)&&(this['_document']['createRoot']('$root',_0x51a792)['_isAttached']=!0x1);}const _0x340d9f=_0x4efcc5['fromJSON'](_0x14d588,this['_document']);return _0x340d9f['wasUndone']=_0x14d588['wasUndone'],_0x340d9f['_isInit']=_0xe3fbc2,_0x340d9f['_authorId']=_0xe3fbc2?null:_0x34666b[_0x400520]['userId'],_0x340d9f['_isDisconnection']='cs:removeUser'===_0x34666b[_0x400520]['type'],_0x340d9f['createdAt']=_0x34666b[_0x400520]['createdAt'],_0x340d9f;});}['_refreshUserSelectionMarkers'](){this['_hasSelectionChanged']=!0x0,this['_shouldSendSelectionUpdate']()?this['_sendBufferedOperationsDelayed']():this['_hasSelectionChanged']=!0x1;}['_shouldSendSelectionUpdate'](){const _0x228819=this['editor']['plugins']['get'](i)['channelSessions']['get'](this['_channelId']);return!this['editor']['isReadOnly']&&!!_0x228819&&_0x228819['length']>0x1&&this['_hasSelectionChanged'];}['_shouldSendUpdate'](){return this['_bufferedOperations']['length']>0x0||this['_shouldSendSelectionUpdate']();}}class K extends Error{}function J(_0x5e64c4,_0x3982f4){for(const _0x114aad of _0x5e64c4)_0x114aad['baseVersion']=_0x3982f4++;}class Q{['_ignoredOperations'];['_operationToId'];constructor(_0x2cef03){this['_ignoredOperations']=_0x2cef03,this['_operationToId']=new WeakMap();}['getIdOfTheLastOperation'](_0x4c733d){let _0x44e000=_0x4c733d['length'];for(;_0x44e000--;){const _0xe8ee7e=_0x4c733d[_0x44e000];if(!this['_ignoredOperations']['has'](_0xe8ee7e)){if(!this['_operationToId']['has'](_0xe8ee7e)){const _0x3c22ac=_0x1ac068()['slice'](0x1,0x12);this['_operationToId']['set'](_0xe8ee7e,_0x3c22ac);}return this['_operationToId']['get'](_0xe8ee7e);}}}['setIdForTheLastOperation'](_0x5517fb,_0x1a16a6){if(!_0x1a16a6)return;let _0x5d9e66=_0x5517fb['length'];for(;_0x5d9e66--;){const _0x531ae3=_0x5517fb[_0x5d9e66];this['_ignoredOperations']['has'](_0x531ae3)||this['_operationToId']['set'](_0x531ae3,_0x1a16a6);}}}class n extends _0x455b90{static get['requires'](){return[l];}static get['pluginName'](){return'RealTimeCollaborativeEditing';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}}class a extends _0x37d354{static ['CommentsService']=/* #__PURE__ -- @preserve */
((()=>et)());['_services'];static get['requires'](){return[c,'CommentsRepository',i,_0x15eabc];}static get['pluginName'](){return'CloudServicesCommentsAdapter';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}constructor(_0x5ba50e){super(_0x5ba50e),this['_services']=new Map();}async['init'](){const _0x250057=this['context'],_0x452956=_0x250057['plugins']['get']('CommentsRepository');if(_0x250057['plugins']['get'](c)['addToReconnectionStack'](this),_0x452956['adapter']={'addCommentThread':async({channelId:_0x1d70e1,threadId:_0x57cb80,comments:_0x197ca8,resolvedAt:_0xb43b8e,resolvedBy:_0x480e0b,context:_0xf9b07b,attributes:_0x491eea})=>{const _0x19de23=await this['_getService'](_0x1d70e1)['addCommentThread']({'commentThreadId':_0x57cb80,'comments':_0x197ca8['map'](_0x2ba734=>function(_0x5a5773,_0x1a4af2,_0x420d3c){return{'commentThreadId':_0x420d3c,'commentId':_0x5a5773['commentId'],'userId':_0x5a5773['authorId'],'content':_0x5a5773['content'],'documentId':_0x1a4af2,'createdAt':_0x5a5773['createdAt'],'attributes':_0x5a5773['attributes']||{}};}(_0x2ba734,_0x1d70e1,_0x57cb80)),'resolvedAt':_0xb43b8e,'resolvedBy':_0x480e0b,'context':_0xf9b07b,'attributes':_0x491eea})['catch'](mt);return{'threadId':_0x19de23['commentThreadId'],'comments':_0x19de23['comments']};},'getCommentThread':async({channelId:_0x1a0fa4,threadId:_0x5b926b})=>{const _0x132685=await this['_getService'](_0x1a0fa4)['getCommentThread'](_0x5b926b)['catch'](mt);return _0x132685['deletedAt']?null:(await this['_fetchMissingUsersForThreads']([_0x132685]),{'threadId':_0x132685['commentThreadId'],'comments':_0x132685['comments']['map'](st),'context':_0x132685['context'],'resolvedAt':_0x132685['resolvedAt'],'resolvedBy':_0x132685['resolvedBy'],'attributes':_0x132685['attributes']||{}});},'updateCommentThread':async({channelId:_0x350162,threadId:_0x7dbbe5,context:_0xc9f587,unlinkedAt:_0x4dc072,attributes:_0x2b2cb7})=>this['_getService'](_0x350162)['updateCommentThread']({'commentThreadId':_0x7dbbe5,'context':_0xc9f587,'attributes':_0x2b2cb7,'unlinkedAt':_0x4dc072})['catch'](ot)['catch'](mt),'resolveCommentThread':async({channelId:_0x3f06dc,threadId:_0x57a88a})=>{const _0x3675f7=await this['_getService'](_0x3f06dc)['resolveCommentThread'](_0x57a88a)['catch'](ot)['catch'](mt);return{'threadId':_0x3675f7['commentThreadId'],'resolvedAt':_0x3675f7['resolvedAt'],'resolvedBy':_0x3675f7['resolvedBy']};},'reopenCommentThread':async({channelId:_0x1edac7,threadId:_0x47b326})=>this['_getService'](_0x1edac7)['reopenCommentThread'](_0x47b326)['catch'](ot)['catch'](mt),'removeCommentThread':({channelId:_0x449cde,threadId:_0x5a50be})=>this['_getService'](_0x449cde)['removeCommentThread'](_0x5a50be)['catch'](ot)['catch'](mt),'addComment':({channelId:_0x2157ac,threadId:_0x3d1a8a,commentId:_0x4933ba,content:_0x57fbd7,attributes:_0x419dee})=>this['_getService'](_0x2157ac)['addComment'](_0x3d1a8a,_0x4933ba,_0x57fbd7,_0x419dee)['catch'](mt),'updateComment':({channelId:_0x5ac002,threadId:_0x1d9bd3,commentId:_0x54a063,content:_0x226e58,attributes:_0x365812})=>this['_getService'](_0x5ac002)['updateComment'](_0x1d9bd3,_0x54a063,_0x226e58,_0x365812)['catch'](ot)['catch'](mt),'removeComment':({channelId:_0x2d3eb7,threadId:_0x1de823,commentId:_0x1f7c58})=>this['_getService'](_0x2d3eb7)['removeComment'](_0x1de823,_0x1f7c58)['catch'](ot)['catch'](mt)},_0x250057 instanceof tt){const _0xda098=_0x250057['config']['get']('collaboration.channelId'),_0x515ce5=_0x250057['plugins']['get'](i);await this['_setUpService'](_0xda098);const _0x3b6d22=await this['_services']['get'](_0xda098)['getConnectedSessions']();this['listenTo'](_0x515ce5,'sessionAdd:'+_0xda098,(_0x3a46bc,{session:_0x3c62ca})=>{_0x3c62ca['id']===_0x515ce5['mySessionId']&&(_0x3a46bc['off'](),this['context']['plugins']['get']('Permissions')['setPermissions'](_0x3c62ca['permissions'],_0xda098));}),_0x515ce5['register'](_0xda098,_0x3b6d22);}}async['_setUpService'](_0x4c79fb){if(this['_services']['has'](_0x4c79fb))throw new _0x347968('cloudservicescommentsadapter-connect-already-connected',null,{'channelId':_0x4c79fb});const _0x4df7b7=this['context']['plugins']['get']('CommentsRepository'),_0x28d013=new a['CommentsService'](_0x4c79fb);this['_services']['set'](_0x4c79fb,_0x28d013),this['listenTo'](_0x28d013,'commentThreadAdded',(_0x4385ca,_0x327095)=>{const {commentThreadId:_0x410e07,documentId:_0x2bf73b,context:_0x3487a8,attributes:_0x1c8e4f,resolvedAt:_0x1dee26,resolvedBy:_0x54ee86,comments:_0x59e85d}=_0x327095;_0x4df7b7['getCommentThread'](_0x410e07)||_0x4df7b7['addCommentThread']({'threadId':_0x410e07,'channelId':_0x2bf73b,'comments':_0x59e85d?_0x59e85d['map'](st):[],'context':_0x3487a8,'attributes':_0x1c8e4f,'resolvedAt':_0x1dee26,'resolvedBy':_0x54ee86,'isFromAdapter':!0x0});}),this['listenTo'](_0x28d013,'commentThreadUpdated',(_0x1af6a3,{commentThreadId:_0x592fdf,documentId:_0x13bc9a,context:_0x485de0,unlinkedAt:_0x17c9dc,attributes:_0x295569})=>{_0x4df7b7['getCommentThread'](_0x592fdf)&&_0x4df7b7['updateCommentThread']({'threadId':_0x592fdf,'channelId':_0x13bc9a,'context':_0x485de0,'unlinkedAt':_0x17c9dc,'attributes':_0x295569,'isFromAdapter':!0x0});}),this['listenTo'](_0x28d013,'commentThreadResolved',(_0x10be84,{commentThreadId:_0x3cfd12,resolvedBy:_0x19969b,resolvedAt:_0x46088a})=>{const _0x18f705=_0x4df7b7['getCommentThread'](_0x3cfd12);_0x18f705&&_0x18f705['resolve']({'resolvedBy':_0x19969b,'resolvedAt':_0x46088a,'isFromAdapter':!0x0});}),this['listenTo'](_0x28d013,'commentThreadReopened',(_0x4d9de5,{commentThreadId:_0x49c99e})=>{const _0x45c9f4=_0x4df7b7['getCommentThread'](_0x49c99e);_0x45c9f4&&_0x45c9f4['reopen']({'isFromAdapter':!0x0});}),this['listenTo'](_0x28d013,'commentThreadRemoved',(_0x53c6af,{commentThreadId:_0x2fd07b})=>{const _0x14a8a0=_0x4df7b7['getCommentThread'](_0x2fd07b);_0x14a8a0&&_0x14a8a0['remove']({'isFromAdapter':!0x0});}),this['listenTo'](_0x28d013,'commentAdded',(_0x1582b1,_0x30b786)=>{const _0x15bc1e=_0x30b786['commentThreadId'],_0x25d00d=_0x4df7b7['getCommentThread'](_0x15bc1e);_0x25d00d&&_0x25d00d['addComment']({...st(_0x30b786),'isFromAdapter':!0x0});}),this['listenTo'](_0x28d013,'commentUpdated',(_0x4596c8,{commentThreadId:_0xf8cb9,commentId:_0x248853,content:_0x3790f5,attributes:_0x2aa080})=>{const _0x297d52=_0x4df7b7['getCommentThread'](_0xf8cb9);if(_0x297d52){const _0x3c1f85=_0x297d52['getComment'](_0x248853);_0x3c1f85&&_0x3c1f85['update']({'content':_0x3790f5,'attributes':_0x2aa080,'isFromAdapter':!0x0});}}),this['listenTo'](_0x28d013,'commentRemoved',(_0x1947eb,{commentThreadId:_0x1ac0c5,commentId:_0x45ddc4})=>{const _0x103a7e=_0x4df7b7['getCommentThread'](_0x1ac0c5);if(_0x103a7e){const _0x2ebb9a=_0x103a7e['getComment'](_0x45ddc4);_0x2ebb9a&&_0x2ebb9a['remove']({'isFromAdapter':!0x0});}}),await this['_connectService'](_0x4c79fb);}['destroy'](){if(this['context']instanceof tt){const _0x5a9e6f=this['context']['config']['get']('collaboration.channelId');this['_terminateService'](_0x5a9e6f);}}['_terminateService'](_0x16db0a){if(!this['_services']['has'](_0x16db0a))throw new _0x347968('cloudservicescommentsadapter-disconnect-not-exist',null,{'channelId':_0x16db0a});this['_getService'](_0x16db0a)['disconnect'](),this['_services']['delete'](_0x16db0a);}async['reconnect'](){for(const _0x1c4ce8 of this['_services']['keys']())await this['_connectService'](_0x1c4ce8);if(this['context']instanceof tt){const _0x34cb10=this['context']['config']['get']('collaboration.channelId'),_0x3612b0=this['context']['plugins']['get'](i);_0x3612b0['unregister'](_0x34cb10);const _0x1a0f36=await this['_services']['get'](_0x34cb10)['getConnectedSessions']();_0x3612b0['register'](_0x34cb10,_0x1a0f36);}}async['_connectService'](_0x3f67ae){const {connection:_0x194b07}=this['context']['plugins']['get'](c),_0x9ed03a=this['context']['plugins']['get']('CommentsRepository'),_0x1f9dcf=this['_services']['get'](_0x3f67ae),_0x7bc73f=await _0x1f9dcf['connect'](_0x194b07);await this['_fetchMissingUsersForThreads'](_0x7bc73f);const _0x4d02e4=new Set(Array['from'](_0x9ed03a['getCommentThreads']({'channelId':_0x3f67ae}),_0x558886=>_0x558886['id']));for(const _0x10e3fa of _0x7bc73f)_0x10e3fa['deletedAt']||_0x4d02e4['delete'](_0x10e3fa['commentThreadId']);for(const _0x3a5da7 of _0x4d02e4)_0x9ed03a['getCommentThread'](_0x3a5da7)['remove']({'isFromAdapter':!0x0});for(const _0x2c2d5d of _0x7bc73f){let _0x1d37e3=_0x9ed03a['getCommentThread'](_0x2c2d5d['commentThreadId']);const {commentThreadId:_0x34468d,context:_0x4f1d44,attributes:_0x1490a6,resolvedBy:_0x328bfb,resolvedAt:_0x14e784,unlinkedAt:_0x2420c7,deletedAt:_0x2e7b07}=_0x2c2d5d;if(_0x2e7b07)continue;_0x1d37e3||(_0x1d37e3=_0x9ed03a['addCommentThread']({'channelId':_0x3f67ae,'threadId':_0x34468d,'context':_0x4f1d44,'attributes':_0x1490a6||{},'resolvedBy':_0x328bfb,'resolvedAt':_0x14e784,'unlinkedAt':_0x2420c7,'isFromAdapter':!0x0}));const _0x5bd661=new Set(Array['from'](_0x1d37e3['comments'],_0xc8abe8=>_0xc8abe8['id']));for(const _0x4c898f of _0x2c2d5d['comments'])_0x5bd661['delete'](_0x4c898f['commentId']);for(const _0x473073 of _0x5bd661)_0x1d37e3['getComment'](_0x473073)['remove']({'isFromAdapter':!0x0});for(const _0x2ab8e6 of _0x2c2d5d['comments']){const _0xa66900=_0x1d37e3['getComment'](_0x2ab8e6['commentId']);_0xa66900?_0xa66900['content']!==_0x2ab8e6['content']&&_0xa66900['update']({'content':_0x2ab8e6['content'],'isFromAdapter':!0x0}):_0x1d37e3['addComment'](Object['assign'](st(_0x2ab8e6),{'isFromAdapter':!0x0}));}}}['_getService'](_0x7c2a4f){if(!this['_services']['has'](_0x7c2a4f))throw new _0x347968('cloudservicescommentsadapter-service-not-exist',null,{'channelId':_0x7c2a4f});return this['_services']['get'](_0x7c2a4f);}async['_fetchMissingUsersForThreads'](_0x43b429){const _0x2b6c5=this['context']['plugins']['get'](_0x15eabc),{connection:_0x1496d0}=this['context']['plugins']['get'](c),_0x134335=new Set();for(const {resolvedBy:_0x511740,comments:_0x2ab88c}of _0x43b429){_0x511740&&!_0x2b6c5['getUser'](_0x511740)&&_0x134335['add'](_0x511740);for(const {userId:_0xafd9d9}of _0x2ab88c)_0x2b6c5['getUser'](_0xafd9d9)||_0x134335['add'](_0xafd9d9);}if(0x0===_0x134335['size'])return;const _0x135bd2=await ft['getMany'](_0x1496d0,Array['from'](_0x134335));for(const _0x555707 of _0x135bd2)_0x2b6c5['getUser'](_0x555707['id'])||_0x2b6c5['addUser'](_0x555707);}}async function ot(_0x37892a){if('404'!==_0x37892a['code'])throw _0x37892a;}function mt(_0x551e3f){if((_0x138e28=_0x551e3f)['message']['startsWith']('cloud-services-internal-error:\x20Comments\x20Service\x20is\x20not\x20connected.')||_0x138e28['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x138e28['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.'))return new Promise(()=>{});var _0x138e28;throw _0x551e3f;}function st(_0x31f088){return{'threadId':_0x31f088['commentThreadId'],'commentId':_0x31f088['commentId'],'content':_0x31f088['content'],'createdAt':_0x31f088['createdAt'],'authorId':_0x31f088['userId'],'attributes':_0x31f088['attributes']||{}};}class f extends _0x455b90{static ['TrackChangesService']=/* #__PURE__ -- @preserve */
((()=>it)());['_bufferedRequests'];['_trackChangesService'];static get['requires'](){return[a,'TrackChangesEditing',c];}static get['pluginName'](){return'CloudServicesTrackChangesAdapter';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}constructor(_0x5f40a6){super(_0x5f40a6);const _0x2333d3=this['editor']['config']['get']('collaboration.channelId');this['_bufferedRequests']=new Map(),this['_trackChangesService']=new f['TrackChangesService'](_0x2333d3);}['init'](){const _0x15c343=this['editor']['plugins']['get'](c),_0x4552b9=this['editor']['plugins']['get']('TrackChangesEditing');return _0x4552b9['adapter']={'getSuggestion':async _0xbcc8b9=>{await this['_waitForServiceReady']();const _0x1550c8=await this['_trackChangesService']['get'](_0xbcc8b9)['catch'](nt);return await this['_fetchMissingUsersForThreads']([_0x1550c8]),_0x1550c8;},'addSuggestion':async({id:_0x22ce28,type:_0x24a635,data:_0x2adb25,originalSuggestionId:_0x405f6a,attributes:_0x507489})=>{await this['_waitForServiceReady']();const _0x1a2369={'id':_0x22ce28,'type':_0x24a635,'data':_0x2adb25,'originalSuggestionId':_0x405f6a,'attributes':_0x507489},_0x560212=await this['_trackChangesService']['add'](_0x22ce28,_0x24a635,_0x2adb25,_0x405f6a,_0x507489)['catch'](_0x27c989=>{if(pt(_0x27c989))return new Promise(_0x4233cf=>{this['_bufferedRequests']['set'](_0x22ce28,{'resolve':_0x4233cf,'suggestionData':_0x1a2369});});throw _0x27c989;});return this['_bufferedRequests']['delete'](_0x22ce28),_0x560212;},'updateSuggestion':async(_0x2311fc,_0x5b8d3d)=>{if(await this['_waitForServiceReady'](),'open'!==_0x5b8d3d['state'])return this['_trackChangesService']['update'](_0x2311fc,_0x5b8d3d)['catch'](nt);}},this['listenTo'](this['_trackChangesService'],'suggestionUpdated',(_0x21261d,_0x4b61b1)=>{_0x4552b9['hasSuggestion'](_0x4b61b1['id'])&&(_0x4552b9['getSuggestion'](_0x4b61b1['id'])['attributes']=_0x4b61b1['attributes']);}),this['_trackChangesService']['connect'](_0x15c343['connection'])['then'](_0xc28415=>(_0x15c343['addToReconnectionStack'](this),this['_fetchMissingUsersForThreads'](_0xc28415)['then'](()=>{for(const _0x16f576 of _0xc28415){_0x4552b9['addSuggestionData'](_0x16f576)['_saved']=!0x0;}})));}async['reconnect'](){const _0x1f2203=this['editor']['plugins']['get']('TrackChangesEditing'),{connection:_0x3bada7}=this['editor']['plugins']['get'](c),_0x1db399=await this['_trackChangesService']['connect'](_0x3bada7);await this['_fetchMissingUsersForThreads'](_0x1db399);for(const {suggestionData:_0x4324f7,resolve:_0xd25fde}of this['_bufferedRequests']['values']()){let _0xdf6181=_0x1db399['find'](_0x5b1c86=>_0x5b1c86['id']===_0x4324f7['id']);_0xdf6181||(_0xdf6181=await this['_trackChangesService']['add'](_0x4324f7['id'],_0x4324f7['type'],_0x4324f7['data'],_0x4324f7['originalSuggestionId'])),_0xd25fde(_0xdf6181);}for(const _0x4bce40 of _0x1db399)_0x1f2203['hasSuggestion'](_0x4bce40['id'])||_0x1f2203['addSuggestionData'](_0x4bce40);}async['_waitForServiceReady'](){this['_trackChangesService']['isConnected']||await new Promise(_0x275b54=>{this['listenTo'](this['_trackChangesService'],'connected',_0xfa328e=>{_0xfa328e['off'](),_0x275b54();});});}async['_fetchMissingUsersForThreads'](_0x1ac9d8){const _0x185c83=this['editor']['plugins']['get'](_0x15eabc),{connection:_0x5dc058}=this['editor']['plugins']['get'](c),_0x350263=new Set();for(const {authorId:_0x3bfc84}of _0x1ac9d8)_0x185c83['getUser'](_0x3bfc84)||_0x350263['add'](_0x3bfc84);if(0x0===_0x350263['size'])return;const _0xafde73=await ft['getMany'](_0x5dc058,Array['from'](_0x350263));for(const _0x12d381 of _0xafde73)_0x185c83['getUser'](_0x12d381['id'])||_0x185c83['addUser'](_0x12d381);}}function nt(_0x568b5a){if(pt(_0x568b5a))return new Promise(()=>{});throw _0x568b5a;}function pt(_0x3e25b7){return _0x3e25b7['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x3e25b7['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}class m extends _0x455b90{static get['requires'](){return['Comments',a,n,c];}static get['pluginName'](){return'RealTimeCollaborativeComments';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}['init'](){const _0x540db8=this['editor']['plugins']['get'](c),_0x456bb2=this['editor']['plugins']['get']('CommentsEditing'),_0x319981=this['editor']['plugins']['get'](a);return this['editor']['data']['once']('ready',()=>{this['listenTo'](_0x540db8,'change:state',(_0x1335e8,_0x47389e,_0x1723ea)=>{_0x456bb2['isThreadsLoadingPaused']='connected'!==_0x1723ea;});}),this['listenTo'](_0x540db8,'change:state',(_0x4fe496,_0x236dda,_0x4e0b32)=>{this['editor']['plugins']['get']('CommentsRepository')['switchReadOnly']('connected'!==_0x4e0b32);}),_0x319981['_setUpService'](this['editor']['config']['get']('collaboration.channelId'));}['destroy'](){this['editor']['plugins']['get'](a)['_terminateService'](this['editor']['config']['get']('collaboration.channelId')),super['destroy']();}}class p extends _0x455b90{static get['requires'](){return[m,f,'TrackChanges'];}static get['pluginName'](){return'RealTimeCollaborativeTrackChanges';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}}class u extends _0x455b90{static ['RevisionHistoryService']=/* #__PURE__ -- @preserve */
((()=>_0x1ac6b3)());['_lastRequestId'];['_revisionTracker'];['_revisionHistoryService'];['_oldOffset'];static get['requires'](){return[c,l,'RevisionTracker',i,_0x15eabc];}static get['pluginName'](){return'CloudServicesRevisionHistoryAdapter';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}constructor(_0x115a4d){super(_0x115a4d);const _0x422621=this['editor']['config']['get']('collaboration.channelId');this['_lastRequestId']=null,this['_revisionTracker']=this['editor']['plugins']['get']('RevisionTracker'),this['_revisionHistoryService']=new u['RevisionHistoryService'](_0x422621);}async['init'](){const _0x42915f=this['editor']['plugins']['get'](l),_0x18cd52=_0x42915f['serverHistory'],_0x9bb69f=this['editor']['plugins']['get'](c);this['_revisionTracker']['setSource']({'history':_0x18cd52,'getLatestVersion':()=>this['_getLatestVersion'](),'getCurrentRevisionId':()=>_0x42915f['sessionId']});const _0x1b6bc3=this['editor']['config']['get']('cloudServices.bundleVersion')||ht,_0x9029e3=await _0x5d7202['isBundleUploaded'](_0x9bb69f['connection'],_0x1b6bc3);this['_revisionTracker']['adapter']={'getRevision':async({revisionId:_0x1dcc2c})=>(await this['_waitForServiceReady'](),await this['_revisionHistoryService']['getRevision'](_0x1dcc2c)),'updateRevisions':async _0x373d86=>{await this['_waitForServiceReady']();const _0x3b61ae=this['_revisionTracker']['currentRevision'];if(_0x9029e3&&0x1===_0x373d86['length']&&_0x373d86[0x0]['id']===_0x3b61ae['id'])return _0x373d86;for(const _0xeadbbb of _0x373d86)_0xeadbbb['id']===_0x3b61ae['id']&&(_0xeadbbb['isEmptyCurrent']=_0xeadbbb['fromVersion']===_0xeadbbb['toVersion']);return this['_revisionHistoryService']['updateRevisions'](_0x373d86,this['_lastRequestId'])['then'](_0x14f176=>(this['_lastRequestId']=_0x14f176,_0x373d86))['catch'](_0x197ec8=>{if(M(_0x197ec8)||'400'===_0x197ec8['code']&&void 0x0!==_0x197ec8['data']['wrongRequestId']){for(const _0x5969b6 of _0x373d86){!this['_revisionTracker']['repository']['getRevision'](_0x5969b6['id'])||this['_revisionTracker']['_bufferUpdate'](_0x5969b6['id'],_0x5969b6,!0x1);}if(M(_0x197ec8))throw _0x197ec8;return _0x373d86;}throw _0x197ec8;});}},this['listenTo'](this['_revisionHistoryService'],'revisionsUpdated',(_0x5f12ae,{revisionsData:_0x2944f7,requestId:_0x3e9810})=>{Math['max'](..._0x2944f7['map'](_0x31dd0f=>_0x31dd0f['toVersion']))>this['_getLatestVersionFromServerOperations']()-0x1?this['_getLatestVersion']()['then'](()=>{this['_handleRevisionsUpdate'](_0x2944f7,_0x3e9810);}):this['_handleRevisionsUpdate'](_0x2944f7,_0x3e9810);});const {revisions:_0x380e3c,requestId:_0xa3c141}=await this['_revisionHistoryService']['connect'](_0x9bb69f['connection']);_0x9bb69f['addToReconnectionStack'](this),this['_lastRequestId']=_0xa3c141,await this['_fetchMissingUsers'](_0x380e3c);for(const _0x159df2 of _0x380e3c)this['_revisionTracker']['addRevisionData'](_0x159df2);this['listenTo'](_0x42915f,'change:_isConnected',(_0x6e36ba,_0xee4e62,_0x4d7ebf)=>{_0x4d7ebf&&(this['_oldOffset']=_0x42915f['_offset'],_0x6e36ba['off']());}),this['_revisionTracker']['bind']('isEnabled')['to'](_0x9bb69f,'state',_0x39f18f=>_0x39f18f===_0x3cf5df['CONNECTED']);}async['reconnect'](){const _0x41d1bf=this['editor']['plugins']['get'](c),_0xa89d48=this['editor']['plugins']['get'](l),_0x3421d7=async()=>{const _0x5d95d6=this['_revisionTracker']['currentRevision'],_0x398b70=_0x5d95d6['id'],_0x15af1c=_0x398b70!==_0xa89d48['sessionId'];if(_0x15af1c){const _0x229e32=_0xa89d48['_offset']-this['_oldOffset'],_0x3a062f=this['_getLatestVersionFromServerOperations']();this['_revisionTracker']['_revisionDataBuilder']['reInit']();if(_0x5d95d6['toVersion']+_0x229e32!==_0x3a062f){const _0x1a32fb=_0x5d95d6['fromVersion']+_0x229e32,_0xcd8702=this['editor']['plugins']['get'](_0x15eabc),_0x9de2=this['_revisionTracker']['buildRevisionData']({'revision':_0x5d95d6,'from':_0x1a32fb,'to':_0x3a062f});_0x9de2['id']=_0x5d95d6['id'];const _0x1adab2=_0x9de2['authorsIds']['map'](_0x8a7beb=>_0xcd8702['getUser'](_0x8a7beb));_0x5d95d6['_update']({..._0x9de2,'authors':_0x1adab2},!0x0),this['_revisionTracker']['_bufferUpdate'](_0x5d95d6['id'],_0x9de2,!0x0);}this['_revisionTracker']['_startingVersion']=_0x3a062f,(_0x5d95d6['toVersion']===_0x5d95d6['fromVersion']&&!this['_revisionTracker']['_bufferedUpdates']['has'](_0x398b70)&&this['_revisionTracker']['repository']['_revisions']['remove'](_0x398b70),this['_revisionTracker']['_createCurrentRevision'](_0x3a062f));}const {revisions:_0x270ff4,requestId:_0x144228}=await this['_revisionHistoryService']['reconnect'](_0x41d1bf['connection'],this['_lastRequestId']);_0x15af1c&&_0x270ff4['length']>0x0?_0xa89d48['_handleReconnectionError']():(await this['_fetchMissingUsers'](_0x270ff4),this['_handleRevisionsUpdate'](_0x270ff4,_0x144228),this['_revisionTracker']['sendBufferedUpdates']());};return _0xa89d48['_isConnected']?_0x3421d7():new Promise((_0x4067f9,_0x1c2584)=>{_0xa89d48['once']('change:_isConnected',()=>{_0x3421d7()['then'](_0x4067f9)['catch'](_0x1c2584);});});}['destroy'](){super['destroy']();}async['_waitForServiceReady'](){this['_revisionHistoryService']['isConnected']||await new Promise(_0x33d37e=>{this['listenTo'](this['_revisionHistoryService'],'connected',_0xc545bc=>{_0xc545bc['off'](),_0x33d37e();});});}['_getLatestVersionFromServerOperations'](){const _0x52ecfb=this['editor']['plugins']['get'](l)['serverHistory']['getOperations']()['reverse']();for(const _0x19845f of _0x52ecfb)if('marker'!==_0x19845f['type']||_0x19845f['affectsData'])return _0x19845f['baseVersion']+0x1;}['_getLatestVersion'](){const _0x331c10=this['editor']['plugins']['get'](l);return new Promise(_0x343437=>{_0x331c10['_isPendingUpdate']?_0x331c10['once']('change:_isPendingUpdate',()=>{_0x343437(this['_getLatestVersionFromServerOperations']());}):_0x343437(this['_getLatestVersionFromServerOperations']());});}['_handleRevisionsUpdate'](_0x4a2f43,_0x4f14fd){const _0xc6a4d2=this['_revisionTracker']['repository'];this['_lastRequestId']=_0x4f14fd;for(const _0x4763a5 of _0x4a2f43){const _0x24a850=_0xc6a4d2['getRevision'](_0x4763a5['id']);if(_0x24a850){if((_0x4763a5['fromVersion']||_0x4763a5['toVersion'])&&(_0x4763a5['diffData']=null),_0x24a850===this['_revisionTracker']['currentRevision']){const _0x477a88=Math['max'](_0x24a850['toVersion'],_0x4763a5['toVersion']),_0x33e531=Math['max'](_0x24a850['fromVersion'],_0x4763a5['fromVersion']);let _0x4bd796;_0x24a850['toVersion']===_0x4763a5['toVersion']&&_0x24a850['fromVersion']===_0x4763a5['fromVersion']?(_0x4bd796=!0x0,this['_preventResendingRevisionData'](_0x4763a5)):_0x4763a5['toVersion']===_0x477a88&&_0x4763a5['fromVersion']===_0x33e531?_0x4bd796=!0x1:(_0x24a850['toVersion']===_0x477a88&&_0x24a850['fromVersion']===_0x33e531||this['_fixRevision']({'revision':_0x24a850,'from':_0x33e531,'to':_0x477a88}),_0x4bd796=!0x0),_0x4bd796&&(delete _0x4763a5['fromVersion'],delete _0x4763a5['toVersion'],delete _0x4763a5['diffData'],delete _0x4763a5['createdAt'],delete _0x4763a5['authorsIds']);}this['_revisionTracker']['setRevisionData'](_0x4763a5),this['_preventResendingRevisionData'](_0x4763a5);}else this['_revisionTracker']['addRevisionData'](_0x4763a5);}const _0x59eb30=_0xc6a4d2['getRevisions']();_0x59eb30['reverse']();for(let _0x3c5713=0x0;_0x3c5713<_0x59eb30['length']-0x1;_0x3c5713++){const _0x331744=_0x59eb30[_0x3c5713],_0x5ab317=_0x59eb30[_0x3c5713+0x1];if(_0x331744['fromVersion']<_0x5ab317['toVersion']){const _0x359b00=_0x5ab317['toVersion'],_0xdb1727=Math['max'](_0x359b00,_0x331744['toVersion']);this['_fixRevision']({'revision':_0x331744,'from':_0x359b00,'to':_0xdb1727});}}}['_fixRevision']({revision:_0x505d55,from:_0x10267a,to:_0x55cd9d}={}){const _0x330fa6=this['editor']['plugins']['get'](_0x15eabc),_0x18591a=this['_revisionTracker']['buildRevisionData']({'revision':_0x505d55,'from':_0x10267a,'to':_0x55cd9d});_0x18591a['authors']=_0x18591a['authorsIds']['map'](_0x532597=>_0x330fa6['getUser'](_0x532597)),_0x505d55['_update'](_0x18591a);}['_preventResendingRevisionData'](_0x9bf11d){const _0x4bd87c={};_0x4bd87c['id']=_0x9bf11d['id'];for(const _0x2f6886 of Object['keys'](_0x9bf11d))'id'!==_0x2f6886&&(_0x4bd87c[_0x2f6886]=void 0x0);this['_revisionTracker']['_bufferUpdate'](_0x4bd87c['id'],_0x4bd87c,!0x0);}async['_fetchMissingUsers'](_0x474287){const _0x10fdb5=this['editor']['plugins']['get'](_0x15eabc),{connection:_0x38e570}=this['editor']['plugins']['get'](c),_0x1c7c8d=new Set();for(const _0x459e1e of _0x474287){for(const _0x7ea533 of _0x459e1e['authorsIds'])_0x46849e(_0x7ea533);_0x459e1e['creatorId']&&_0x46849e(_0x459e1e['creatorId']);}if(0x0===_0x1c7c8d['size'])return;const _0x5997e9=await ft['getMany'](_0x38e570,Array['from'](_0x1c7c8d));for(const _0x28fb66 of _0x5997e9)_0x10fdb5['getUser'](_0x28fb66['id'])||_0x10fdb5['addUser'](_0x28fb66);function _0x46849e(_0x26f917){_0x10fdb5['getUser'](_0x26f917)||_0x1c7c8d['add'](_0x26f917);}}}function M(_0x19c14d){return _0x19c14d['message']['startsWith']('cloud-services-internal-error:\x20Revision\x20History\x20Service\x20is\x20not\x20connected.')||_0x19c14d['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x19c14d['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}class g extends _0x455b90{static get['requires'](){return['RevisionHistory',u,n];}static get['pluginName'](){return'RealTimeCollaborativeRevisionHistory';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}}class ts extends _0x49e569{constructor(_0x2aedd5){super(_0x2aedd5);const _0x3b70b5=this['bindTemplate'];this['set']('usersCount',0x0),this['set']('isHidden',!0x0),this['setTemplate']({'tag':'div','attributes':{'class':['ck','ck-presence-list__counter',_0x3b70b5['if']('isHidden','ck-presence-list__counter--hidden')]},'children':[{'text':_0x3b70b5['to']('usersCount',_0x49e6cf=>F(_0x2aedd5,'CONNECTED_USERS',_0x49e6cf))}]});}}class es extends _0x49e569{['items'];['keystrokes'];constructor(_0xfc47f8){super(_0xfc47f8);const _0x1d2ccb=this['bindTemplate'];this['items']=this['createCollection'](),this['keystrokes']=new _0x58d4c0(),this['set']({'hasPopup':!0x1,'isExpanded':!0x1}),this['setTemplate']({'tag':'div','attributes':{'aria-haspopup':_0x1d2ccb['if']('hasPopup'),'aria-expanded':_0x1d2ccb['to']('isExpanded',_0xa03f50=>this['hasPopup']&&String(_0xa03f50)),'aria-label':_0x1d2ccb['to']('hasPopup',_0x4bacca=>F(_0xfc47f8,_0x4bacca?'Collapsed\x20connected\x20users\x20list\x20(press\x20ENTER\x20to\x20open\x20it)':'Connected\x20users\x20list')),'role':'list','tabindex':_0x1d2ccb['to']('hasPopup',_0x593ff8=>!!_0x593ff8&&0x0),'class':['ck','ck-presence-list__list']},'children':this['items'],'on':{'click':_0x1d2ccb['to'](()=>this['fire']('execute'))}}),this['on']('change:hasPopup',(_0x339141,_0x3b1a4b,_0x1b1d7b)=>{this['element']&&(_0x1b1d7b?this['element']['setAttribute']('aria-expanded',String(this['isExpanded'])):this['element']['removeAttribute']('aria-expanded'));});}['focus'](){this['element']['focus']();}['render'](){super['render'](),this['keystrokes']['listenTo'](this['element']);}}class L extends _0x49e569{['counterView'];['inlineListView'];constructor(_0x45e7ee){super(_0x45e7ee);const _0x570c34=this['bindTemplate'];this['set']('isCollapsed',!0x0),this['counterView']=new ts(this['locale']),this['inlineListView']=new es(_0x45e7ee),this['inlineListView']['bind']('hasPopup')['to'](this,'isCollapsed'),this['listenTo'](this['inlineListView']['items'],'change',()=>{for(const _0x41449a of this['inlineListView']['items'])_0x41449a['tooltipPosition']='s';this['inlineListView']['items']['first']&&(this['inlineListView']['items']['first']['tooltipPosition']='se');}),this['setTemplate']({'tag':'div','attributes':{'class':['ck','ck-presence-list','ck-reset','ck-rounded-corners',_0x570c34['if']('isCollapsed','ck-presence-list--collapsed')]},'children':[this['counterView'],this['inlineListView']]});}}class j extends _0x49e569{['listWrapperView'];constructor(_0x541b0e,_0x26d663){super(_0x541b0e),this['listWrapperView']=new gt(_0x541b0e,_0x26d663),this['setTemplate']({'tag':'div','attributes':{'tabindex':-0x1,'role':'application','class':['ck','ck-presence-list__dropdown-list'],'aria-label':F(_0x541b0e,'Connected\x20users\x20list\x20dropdown\x20menu')},'children':[this['listWrapperView']]});}}class gt extends _0x49cbdf{constructor(_0x4e3ced,_0x4dc2e7){super(_0x4e3ced);const _0x1a8bab=this['bindTemplate'];this['set']('_isScrollable',!0x1),this['setTemplate']({'tag':_0x4dc2e7?'div':'ul','attributes':{'class':['ck','ck-reset','ck-list','ck-presence-list__dropdown-list-wrapper',_0x1a8bab['if']('_isScrollable','ck-presence-list__dropdown-list-wrapper_scrollable')],'role':_0x1a8bab['to']('role'),'aria-label':_0x1a8bab['to']('ariaLabel'),'aria-labelledby':_0x1a8bab['to']('ariaLabelledBy')},'children':this['items']}),this['listenTo'](_0x3c7ff6['window'],'resize',()=>this['checkIfScrollable']()),this['items']['on']('change',()=>this['checkIfScrollable']());}['render'](){super['render'](),this['checkIfScrollable']();}['checkIfScrollable'](){const _0x1114de=this['element'];_0x1114de&&(this['_isScrollable']=Math['max'](_0x1114de['scrollHeight'],_0x1114de['clientHeight'])>0.8*window['innerHeight']);}}class k extends rt{['userView'];constructor(_0x16a4b4,_0x5a891e,_0x1db0a6){super(_0x16a4b4);const _0x195e62=this['bindTemplate'];this['userView']=new ct(_0x16a4b4,_0x5a891e);const _0x324c7d={'tag':'li','attributes':{'class':['ck','ck-presence-list__dropdown-list-item'],'tabindex':-0x1,'role':'presentation','aria-label':_0x5a891e['name']},'children':[this['userView'],{'tag':'span','attributes':{'class':['ck','ck-user__full-name']},'children':[{'text':_0x5a891e['name']}]},{'tag':'span','attributes':{'class':['ck','ck-presence-list__marker',_0x5a891e['color']['getBackgroundColorClass']()],'aria-hidden':'true'}}]};_0x1db0a6&&(_0x324c7d['tag']='button',_0x324c7d['on']={'click':_0x195e62['to'](()=>this['fire']('execute'))}),this['setTemplate'](_0x324c7d);}['focus'](){this['element']['focus']();}}class y extends _0x49e569{['userView'];['markerView'];constructor(_0x23b0bd,_0x5afd82,_0x2cab95){super(_0x23b0bd);const _0x49f8c5=this['bindTemplate'];this['set']('isFocusable',!0x1),this['set']('hasTooltip',!0x0),this['set']('tooltipPosition',''),this['userView']=new ct(_0x23b0bd,_0x5afd82),this['markerView']=new lt(_0x23b0bd,_0x5afd82);const _0x5280ba=new at(_0x23b0bd);_0x5280ba['template']['tag']='span',_0x5280ba['text']=_0x5afd82['name'];const _0xd1e40b={'tag':'div','attributes':{'class':['ck','ck-presence-list__list-item'],'role':'listitem','tabindex':_0x49f8c5['to']('isFocusable',_0x4a50f4=>!!_0x4a50f4&&0x0),'aria-labelledby':_0x5280ba['id'],'data-cke-tooltip-text':this['userView']['name'],'data-cke-tooltip-position':_0x49f8c5['to']('tooltipPosition'),'data-cke-tooltip-disabled':_0x49f8c5['to']('hasTooltip',_0x3e8909=>!_0x3e8909),'data-cke-tooltip-class':'ck-presence-list__list-item__tooltip'},'children':[this['userView'],this['markerView'],_0x5280ba]};_0x2cab95&&(_0xd1e40b['tag']='button',_0xd1e40b['on']={'click':_0x49f8c5['to'](()=>this['fire']('execute'))}),this['setTemplate'](_0xd1e40b);}}class lt extends _0x49e569{constructor(_0x23654a,_0x466f98){super(_0x23654a),this['setTemplate']({'tag':'span','attributes':{'class':['ck','ck-presence-list__marker',_0x466f98['color']['getBackgroundColorClass']()],'aria-hidden':'true'}});}}const A={'collapseAt':0x6,'displayMe':!0x0};class r extends _0x37d354{['currentDisplayedUsers'];['balloonPanelView'];['view'];['presenceDropdownView'];['_bodyCollection']=null;constructor(_0x18d49f){super(_0x18d49f),this['context']['config']['define']('presenceList',A);const _0x2ad963=_0x18d49f['config']['get']('presenceList.collapseAt');if('number'!=typeof _0x2ad963)throw new _0x347968('presencelist-collapseat-invalid-format',this);if(_0x2ad963<0x1)throw new _0x347968('presencelist-collapseat-invalid-format',this);this['_allConnectedUsers']=this['context']['plugins']['get'](i)['allConnectedUsers'],this['set']('usersCount',0x0),this['currentDisplayedUsers']=new _0x69c784(),this['balloonPanelView']=new _0x242f2b(),this['balloonPanelView']['class']='ck\x20ck-presence-list__balloon',this['view']=this['_createView'](),this['presenceDropdownView']=void 0x0;}static get['requires'](){return[i];}['init'](){for(const _0x264a1c of this['_allConnectedUsers'])this['_handleUserAdd'](_0x264a1c);this['listenTo'](this['_allConnectedUsers'],'add',(_0x2dabc0,_0x1c68c6)=>{this['_handleUserAdd'](_0x1c68c6);}),this['listenTo'](this['_allConnectedUsers'],'remove',(_0x3b897e,_0x3e9f5f)=>{this['_handleUserRemove'](_0x3e9f5f);});}['_createView'](){const _0x1fd23c=this['context'],_0x139d33=new L(this['context']['locale']),_0x5c0608=this['balloonPanelView'];if(!_0x3dd12e(_0x1fd23c['config']['get']('presenceList.container')))throw new _0x347968('presencelist-missing-container',this);return _0x139d33['counterView']['bind']('usersCount')['to'](this),_0x139d33['bind']('isCollapsed')['to'](this,'usersCount',_0x1c22c6=>{const {collapseAt:_0x3be798,displayMe:_0x2126e9}=_0x1fd23c['config']['get']('presenceList'),_0x4dae1d=_0x1c22c6>=_0x3be798;return _0x139d33['counterView']['isHidden']=!(0x1==_0x1c22c6&&_0x2126e9||_0x4dae1d),_0x4dae1d||this['hideDropdown'](),_0x4dae1d;}),_0x139d33['inlineListView']['items']['bindTo'](this['currentDisplayedUsers'])['using'](_0x50310c=>{const _0x5d7fd2=_0x1fd23c['config']['get']('presenceList'),_0x19d72a=new y(_0x1fd23c['locale'],_0x50310c,!!_0x5d7fd2['onClick']);return _0x19d72a['bind']('hasTooltip')['to'](_0x139d33,'isCollapsed',_0x1e5461=>!_0x1e5461),_0x19d72a['bind']('isFocusable')['to'](_0x139d33,'isCollapsed',_0x117d20=>!_0x117d20),_0x5d7fd2['onClick']&&this['listenTo'](_0x19d72a,'execute',()=>{this['view']['isCollapsed']||_0x5d7fd2['onClick'](_0x50310c,_0x19d72a['element']);}),_0x19d72a;}),this['listenTo'](_0x139d33['inlineListView'],'execute',()=>{this['presenceDropdownView']?this['hideDropdown']():this['view']['isCollapsed']&&this['showDropdown']();}),_0x139d33['inlineListView']['keystrokes']['set']('Enter',(_0x11ebbf,_0x1b8fc5)=>{this['view']['isCollapsed']&&(this['showDropdown'](),_0x1b8fc5());}),_0x139d33['render'](),_0x5c0608['render'](),_0x547f6d({'emitter':_0x139d33,'activator':()=>_0x5c0608['isVisible'],'contextElements':[_0x5c0608['element'],_0x139d33['inlineListView']['element']],'callback':()=>this['hideDropdown']()}),_0x1fd23c['config']['get']('presenceList.container')['appendChild'](_0x139d33['element']),this['_bodyCollection']=new _0x508dce(this['context']['locale']),this['_bodyCollection']['attachToDom'](),this['_bodyCollection']['add'](this['balloonPanelView']),_0x139d33;}['_handleUserAdd'](_0x2d7179){if(!this['context']['config']['get']('presenceList.displayMe')&&_0x2d7179['isMe'])return;const _0x417d6c=this['context']['config']['get']('presenceList.collapseAt')-0x1;this['usersCount']++,this['currentDisplayedUsers']['length']==_0x417d6c&&this['currentDisplayedUsers']['length']>0x1&&this['currentDisplayedUsers']['remove'](0x1);const _0x3b8525=_0x2d7179['isMe']?0x0:this['currentDisplayedUsers']['length'];this['currentDisplayedUsers']['add'](_0x2d7179,_0x3b8525);}['_handleUserRemove'](_0x3e69fc){if(this['usersCount']--,this['currentDisplayedUsers']['get'](_0x3e69fc['id'])&&(this['currentDisplayedUsers']['remove'](_0x3e69fc['id']),this['currentDisplayedUsers']['length']<this['usersCount'])){for(const _0x2b2506 of Array['from'](this['_allConnectedUsers'])['reverse']())if(!this['currentDisplayedUsers']['get'](_0x2b2506['id']))return void this['currentDisplayedUsers']['add'](_0x2b2506,Math['min'](this['currentDisplayedUsers']['length'],0x1));}}['showDropdown'](){if(this['presenceDropdownView'])return;const _0x2e6b20=this['context']['config']['get']('presenceList');this['presenceDropdownView']=new j(this['context']['locale'],!!_0x2e6b20['onClick']),this['view']['inlineListView']['isExpanded']=!0x0;const {listWrapperView:_0x3bd3f5}=this['presenceDropdownView'];_0x3bd3f5['items']['bindTo'](this['_allConnectedUsers'])['using'](_0x3b0c52=>{if(!_0x2e6b20['displayMe']&&_0x3b0c52['isMe'])return null;const _0x18dd54=new k(this['context']['locale'],_0x3b0c52,!!_0x2e6b20['onClick']);return _0x2e6b20['onClick']&&this['listenTo'](_0x18dd54,'execute',()=>{_0x2e6b20['onClick'](_0x3b0c52,_0x18dd54['element']);}),_0x18dd54;}),this['balloonPanelView']['content']['add'](this['presenceDropdownView']),this['balloonPanelView']['pin']({'target':this['view']['inlineListView']['element']}),_0x3bd3f5['focus'](),_0x3bd3f5['checkIfScrollable']();const _0x467784=(_0x1c4d61,_0x33a91c)=>{this['hideDropdown'](),this['view']['inlineListView']['focus'](),_0x33a91c();};_0x3bd3f5['keystrokes']['set']('Esc',_0x467784),_0x3bd3f5['keystrokes']['set']('Shift+Tab',_0x467784),_0x3bd3f5['keystrokes']['set']('Tab',(_0x2b0f71,_0xd358b9)=>{!function(_0xf0e5e5){const _0x3c3bd6=['a','button','input','select','textarea','[tabindex]','[contenteditable]']['map'](_0x3e1022=>_0x3e1022+':not([disabled]):not([tabindex=\x22-1\x22])')['join'](','),_0x1220db=[...document['body']['querySelectorAll'](_0x3c3bd6)]['filter'](_0x5b3845=>_0x5b3845===document['activeElement']||_0x5b3845['offsetWidth']+_0x5b3845['offsetHeight']>0x0)['sort']((_0x47459e,_0x3c593b)=>(_0x47459e['tabIndex']||0x0)-(_0x3c593b['tabIndex']||0x0)),_0x13a198=_0x1220db['indexOf'](_0xf0e5e5),_0xf64c81=_0x1220db[(_0x13a198+0x1)%_0x1220db['length']];_0xf64c81&&_0xf64c81['focus']();}(this['view']['element']),this['hideDropdown'](),_0xd358b9();}),_0x3bd3f5['focusTracker']['add'](this['view']['element']),_0x3bd3f5['focusTracker']['on']('change:isFocused',(_0x374a43,_0x1ad47b,_0x42a4bb)=>{_0x42a4bb||this['hideDropdown']();});}['hideDropdown'](){this['presenceDropdownView']&&(this['view']['inlineListView']['isExpanded']=!0x1,this['balloonPanelView']['unpin'](),this['balloonPanelView']['content']['remove'](this['presenceDropdownView']),this['presenceDropdownView']['destroy'](),this['presenceDropdownView']=void 0x0);}['destroy'](){super['destroy'](),this['view']&&this['view']['isRendered']&&this['view']['destroy'](),this['_bodyCollection']&&(this['_bodyCollection']['detachFromDom'](),this['_bodyCollection']['destroy'](),this['_bodyCollection']=null);}}class s extends _0x37d354{static get['requires'](){return[i,r];}static get['pluginName'](){return'PresenceList';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}}export{a as CloudServicesCommentsAdapter,u as CloudServicesRevisionHistoryAdapter,f as CloudServicesTrackChangesAdapter,s as PresenceList,l as RealTimeCollaborationClient,m as RealTimeCollaborativeComments,n as RealTimeCollaborativeEditing,g as RealTimeCollaborativeRevisionHistory,p as RealTimeCollaborativeTrackChanges};